<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sartorial Telemetry</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="–£–º–Ω—ã–π –≥–∞—Ä–¥–µ—Ä–æ–± —Å AI: –ø–æ–¥–±–æ—Ä –æ–±—Ä–∞–∑–æ–≤, –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∏—Ä–∫–∏, —à–æ–ø–∏–Ω–≥-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç">
    <meta name="theme-color" content="#0ea5e9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="–ì–∞—Ä–¥–µ—Ä–æ–± AI">

    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">

    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Crect width='192' height='192' fill='%230ea5e9'/%3E%3Ctext x='96' y='135' font-size='120' text-anchor='middle' fill='white'%3Eüëî%3C/text%3E%3C/svg%3E">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-gradient-1: #e0f2fe;
            --bg-gradient-2: #bae6fd;
            --bg-gradient-3: #7dd3fc;
            --bg-gradient-4: #38bdf8;
            --card-bg: rgba(255, 255, 255, 0.75);
            --text-primary: #0c4a6e;
            --text-secondary: #0369a1;
            --border-color: rgba(186, 230, 253, 0.5);
            --tab-inactive-bg: rgba(224, 242, 254, 0.5);
            --tab-inactive-text: #0369a1;
            --input-bg: rgba(255, 255, 255, 0.85);
            --modal-bg: rgba(255, 255, 255, 0.95);
            --primary: #0ea5e9;
            --primary-light: #38bdf8;
            --accent: #06b6d4;
            --ocean-deep: #0284c7;
            --ocean-light: #7dd3fc;
        }

        body.dark-theme {
            --bg-gradient-1: #082f49;
            --bg-gradient-2: #0c4a6e;
            --bg-gradient-3: #075985;
            --bg-gradient-4: #0369a1;
            --card-bg: rgba(8, 47, 73, 0.75);
            --text-primary: #e0f2fe;
            --text-secondary: #7dd3fc;
            --border-color: rgba(7, 89, 133, 0.5);
            --tab-inactive-bg: rgba(12, 74, 110, 0.5);
            --tab-inactive-text: #7dd3fc;
            --input-bg: rgba(8, 47, 73, 0.85);
            --modal-bg: rgba(8, 47, 73, 0.95);
            --primary: #0ea5e9;
            --primary-light: #38bdf8;
            --accent: #06b6d4;
            --ocean-deep: #0284c7;
            --ocean-light: #7dd3fc;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes wave {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(-45deg, var(--bg-gradient-1), var(--bg-gradient-2), var(--bg-gradient-3), var(--bg-gradient-4));
            background-size: 400% 400%;
            animation: wave 15s ease infinite;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 20% 50%, rgba(14, 165, 233, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(6, 182, 212, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 40% 20%, rgba(56, 189, 248, 0.15) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }

        body::after {
            content: '';
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 200px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120"><path d="M0,48L48,56C96,64,192,80,288,80C384,80,480,64,576,69.3C672,75,768,101,864,101.3C960,101,1056,75,1152,64C1248,53,1344,59,1392,61.3L1440,64L1440,120L1392,120C1344,120,1248,120,1152,120C1056,120,960,120,864,120C768,120,672,120,576,120C480,120,384,120,288,120C192,120,96,120,48,120L0,120Z" fill="rgba(14, 165, 233, 0.1)"/></svg>') repeat-x;
            animation: wave-move 20s linear infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes wave-move {
            0% { background-position: 0 0; }
            100% { background-position: 1200px 0; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
            padding: 60px 32px;
        }

        .card {
            background: var(--card-bg);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-radius: 24px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08),
                        0 2px 8px rgba(0, 0, 0, 0.04);
            padding: 48px;
            margin-bottom: 40px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.12),
                        0 4px 12px rgba(0, 0, 0, 0.06);
        }

        /* Typography Scale */
        h1 {
            font-size: 56px;
            font-weight: 700;
            letter-spacing: -0.03em;
            line-height: 1.1;
        }

        h2 {
            font-size: 32px;
            font-weight: 700;
            letter-spacing: -0.02em;
            line-height: 1.2;
            margin-bottom: 24px;
        }

        h3 {
            font-size: 24px;
            font-weight: 600;
            letter-spacing: -0.01em;
            line-height: 1.3;
            margin-bottom: 20px;
        }

        h4 {
            font-size: 18px;
            font-weight: 600;
            line-height: 1.4;
            margin-bottom: 12px;
        }

        .icon-btn {
            padding: 12px;
            background: var(--input-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 20px;
        }

        .icon-btn:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
            border-color: var(--primary);
        }

        .icon-btn:active {
            transform: scale(0.95);
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 32px;
            margin: 48px 0;
        }

        .info-card {
            border-radius: 20px;
            padding: 32px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .info-card:hover {
            transform: translateY(-4px);
        }

        .weather-card {
            background: linear-gradient(135deg, rgba(147, 197, 253, 0.3) 0%, rgba(191, 219, 254, 0.2) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(147, 197, 253, 0.3);
        }
        .location-card {
            background: linear-gradient(135deg, rgba(167, 243, 208, 0.3) 0%, rgba(209, 250, 229, 0.2) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(167, 243, 208, 0.3);
        }
        .vibe-card {
            background: linear-gradient(135deg, rgba(216, 180, 254, 0.3) 0%, rgba(233, 213, 255, 0.2) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(216, 180, 254, 0.3);
        }

        .info-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            font-weight: 600;
            font-size: 16px;
        }

        .tabs {
            display: flex;
            gap: 12px;
            padding: 12px;
            background: var(--tab-inactive-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid var(--border-color);
            margin-bottom: 32px;
        }

        .tab {
            flex: 1;
            padding: 20px 32px;
            border: none;
            background: transparent;
            color: var(--tab-inactive-text);
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            border-radius: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            letter-spacing: -0.2px;
        }

        .tab.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(244, 63, 94, 0.3);
        }

        .tab:hover:not(.active) {
            background: rgba(244, 63, 94, 0.1);
            color: var(--primary);
            transform: translateY(-2px);
        }

        .tab:active {
            transform: scale(0.98);
        }

        .tab-content {
            padding: 56px 0;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .wardrobe-item, .outfit-card {
            animation: slideIn 0.3s ease-out;
        }

        .card {
            animation: fadeIn 0.5s ease-in;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 16px;
            font-weight: 700;
            font-size: 17px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(244, 63, 94, 0.35);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            letter-spacing: -0.01em;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 28px rgba(244, 63, 94, 0.45);
        }

        .btn-primary:active:not(:disabled) {
            transform: scale(0.98);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #8b5cf6;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-secondary:hover {
            background: #7c3aed;
        }

        .input {
            padding: 16px 20px;
            border: 2px solid var(--border-color);
            border-radius: 14px;
            font-size: 15px;
            width: 100%;
            background: var(--input-bg);
            backdrop-filter: blur(10px);
            color: var(--text-primary);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
        }

        .input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(244, 63, 94, 0.1);
            transform: translateY(-1px);
        }

        .input:hover {
            border-color: rgba(244, 63, 94, 0.4);
        }

        .select {
            padding: 16px 20px;
            border: 2px solid var(--border-color);
            border-radius: 14px;
            font-size: 15px;
            width: 100%;
            background: var(--input-bg);
            backdrop-filter: blur(10px);
            color: var(--text-primary);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            font-weight: 500;
        }

        .select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(244, 63, 94, 0.1);
        }

        .select:hover {
            border-color: rgba(244, 63, 94, 0.4);
        }

        .outfit-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 32px;
            margin-top: 40px;
        }

        .outfit-card {
            background: linear-gradient(135deg, rgba(250, 245, 255, 0.5) 0%, rgba(252, 231, 243, 0.5) 100%);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 32px;
            border: 1px solid rgba(216, 180, 254, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .outfit-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(139, 92, 246, 0.15);
        }

        .outfit-item {
            background: var(--card-bg);
            backdrop-filter: blur(5px);
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 12px;
            font-weight: 500;
            font-size: 15px;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .wardrobe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 32px;
            margin-top: 48px;
        }

        .wardrobe-item {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 32px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .wardrobe-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            border-color: var(--primary);
        }

        .wardrobe-item img {
            transition: transform 0.3s ease;
        }

        .wardrobe-item:hover img {
            transform: scale(1.05);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--modal-bg);
            border-radius: 16px;
            padding: 24px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            transition: all 0.3s ease;
        }

        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden { display: none; }
        .text-center { text-align: center; }
        .mb-4 { margin-bottom: 16px; }
        .mt-4 { margin-top: 16px; }
        .flex { display: flex; }
        .gap-2 { gap: 8px; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="card">
            <div style="text-align: center; padding: 32px 0 40px; position: relative;">
                <button class="icon-btn" onclick="toggleTheme()" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É" id="theme-toggle" style="position: absolute; top: 24px; right: 24px; width: 48px; height: 48px; font-size: 20px;">üåô</button>
                <h1 style="font-size: 56px; font-weight: 700; margin-bottom: 20px; letter-spacing: -0.03em; color: var(--text-primary);">Sartorial Telemetry</h1>
                <p style="font-size: 22px; color: var(--text-secondary); font-weight: 400; max-width: 700px; margin: 0 auto;">AI-–≥–∞—Ä–¥–µ—Ä–æ–±, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑—ã, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å—Ç–∏—Ä–∫—É –∏ —ç–∫–æ–Ω–æ–º–∏—Ç –¥–µ–Ω—å–≥–∏</p>
            </div>

            <!-- –ò–Ω—Ñ–æ-–∫–∞—Ä—Ç–æ—á–∫–∏ -->
            <div class="grid-3">
                <div class="info-card weather-card">
                    <div class="info-card-header">
                        <span>–ü–æ–≥–æ–¥–∞</span>
                    </div>
                    <div id="weather-display">–£–∫–∞–∂–∏—Ç–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</div>
                </div>

                <div class="info-card location-card">
                    <div class="info-card-header">
                        <span>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</span>
                        <button class="icon-btn" onclick="showLocationModal()" title="–ò–∑–º–µ–Ω–∏—Ç—å" style="font-size: 16px;">‚öô</button>
                    </div>
                    <div id="location-display">
                        <button class="btn-secondary" onclick="requestLocation()">–ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
                        <button class="btn-secondary mt-4" onclick="showLocationModal()">–£–∫–∞–∑–∞—Ç—å –≤—Ä—É—á–Ω—É—é</button>
                    </div>
                </div>

                <div class="info-card vibe-card">
                    <div class="info-card-header">
                        <span>–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</span>
                    </div>
                    <select id="vibe-select" class="select" onchange="saveVibe()">
                        <option value="casual">–ü–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–µ</option>
                        <option value="smart-casual">–°–º–∞—Ä—Ç-–∫—ç–∂—É–∞–ª</option>
                        <option value="dressy">–ù–∞—Ä—è–¥–Ω–æ–µ</option>
                        <option value="sporty">–°–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ</option>
                        <option value="edgy">–î–µ—Ä–∑–∫–æ–µ</option>
                        <option value="romantic">–†–æ–º–∞–Ω—Ç–∏—á–Ω–æ–µ</option>
                    </select>
                    <input type="text" id="occasion-input" class="input mt-4" placeholder="–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ..." onchange="saveOccasion()">
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="card" style="padding: 32px; overflow: hidden;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px;">
                <!-- –û—Å–Ω–æ–≤–Ω–æ–µ -->
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <div style="font-size: 11px; font-weight: 700; letter-spacing: 1px; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 4px;">–û—Å–Ω–æ–≤–Ω–æ–µ</div>
                    <button class="tab active" onclick="switchTab('suggest')" style="flex: none; border-radius: 12px; justify-content: flex-start; padding: 16px 20px;">–ü–æ–¥–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑</button>
                    <button class="tab" onclick="switchTab('wardrobe')" style="flex: none; border-radius: 12px; justify-content: flex-start; padding: 16px 20px;">–ì–∞—Ä–¥–µ—Ä–æ–±</button>
                </div>

                <!-- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ -->
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <div style="font-size: 11px; font-weight: 700; letter-spacing: 1px; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 4px;">–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
                    <button class="tab" onclick="switchTab('laundry')" style="flex: none; border-radius: 12px; justify-content: flex-start; padding: 16px 20px;">–°—Ç–∏—Ä–∫–∞</button>
                    <button class="tab" onclick="switchTab('shop')" style="flex: none; border-radius: 12px; justify-content: flex-start; padding: 16px 20px;">–®–æ–ø–∏–Ω–≥</button>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞: –ü–æ–¥–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ -->
            <div id="tab-suggest" class="tab-content">
                <div class="text-center">
                    <h2 style="color: var(--text-primary);">–ì–æ—Ç–æ–≤—ã –≤—ã–≥–ª—è–¥–µ—Ç—å –æ—Ç–ª–∏—á–Ω–æ?</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 40px; max-width: 600px; margin-left: auto; margin-right: auto; font-size: 17px; line-height: 1.6;">
                        –ù–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–≥–æ–¥—ã, –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∏ –≥–∞—Ä–¥–µ—Ä–æ–±–∞ –ø–æ–¥–±–µ—Ä—É 3 –∏–¥–µ–∞–ª—å–Ω—ã—Ö –æ–±—Ä–∞–∑–∞ –ø–æ–¥ –≤–∞—à–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
                    </p>
                    <button id="generate-btn" class="btn-primary" onclick="generateOutfits()" style="font-size: 18px; padding: 20px 48px;">
                        –ü–æ–¥–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã
                    </button>
                    <p id="generate-error" class="mt-4" style="color: #ea580c;"></p>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
            <div id="tab-results" class="tab-content hidden">
                <h2 class="text-center mb-4" style="color: var(--text-primary);">–í–∞—à–∏ –æ–±—Ä–∞–∑—ã</h2>
                <div id="outfits-container" class="outfit-grid"></div>
                <div class="text-center mt-4">
                    <button onclick="switchTab('suggest')" style="background: none; border: none; color: var(--ocean-deep); font-weight: 600; cursor: pointer; font-size: 16px;">‚Üê –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞: –ì–∞—Ä–¥–µ—Ä–æ–± -->
            <div id="tab-wardrobe" class="tab-content hidden">
                <!-- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è -->
                <div style="background: linear-gradient(135deg, rgba(125, 211, 252, 0.3) 0%, rgba(56, 189, 248, 0.2) 100%); padding: 32px; border-radius: 16px; margin-bottom: 32px;">
                    <h3 style="color: var(--text-primary);">–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div>
                            <label style="font-weight: 600; margin-bottom: 12px; display: block; color: var(--text-primary);">–í–æ–∑—Ä–∞—Å—Ç–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                            <select id="age-group" class="select" onchange="savePersonalization()">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
                                <option value="18-24">18-24 –≥–æ–¥–∞</option>
                                <option value="24-40">24-40 –ª–µ—Ç</option>
                                <option value="40+">40+ –ª–µ—Ç</option>
                            </select>
                        </div>
                        <div>
                            <label style="font-weight: 600; margin-bottom: 12px; display: block; color: var(--text-primary);">–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π —Å—Ç–∏–ª—å</label>
                            <select id="preferred-style" class="select" onchange="savePersonalization()">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
                                <option value="oversized">–ú—è–≥–∫–∏–π oversized (—Ö—É–¥–∏, —Å–≤–∏—Ç–µ—Ä–∞)</option>
                                <option value="business">–°—Ç—Ä–æ–≥–∏–π business casual</option>
                                <option value="sport">–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å</option>
                                <option value="mixed">–°–º–µ—à–∞–Ω–Ω—ã–π —Å—Ç–∏–ª—å</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, rgba(224, 242, 254, 0.4) 0%, rgba(186, 230, 253, 0.3) 100%); padding: 40px; border-radius: 20px; margin-bottom: 48px; border: 1px solid rgba(186, 230, 253, 0.5);">
                    <h3 style="color: var(--text-primary); margin-bottom: 32px;">–î–æ–±–∞–≤–∏—Ç—å –≤–µ—â—å</h3>

                    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                    <div style="display: grid; gap: 24px; margin-bottom: 32px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <label style="font-size: 13px; font-weight: 600; margin-bottom: 8px; display: block; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                                <select id="new-type" class="select">
                                    <option value="top">–í–µ—Ä—Ö</option>
                                    <option value="bottom">–ù–∏–∑</option>
                                    <option value="outerwear">–í–µ—Ä—Ö–Ω—è—è –æ–¥–µ–∂–¥–∞</option>
                                    <option value="shoes">–û–±—É–≤—å</option>
                                    <option value="accessory">–ê–∫—Å–µ—Å—Å—É–∞—Ä</option>
                                </select>
                            </div>
                            <div>
                                <label style="font-size: 13px; font-weight: 600; margin-bottom: 8px; display: block; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;">–°–µ–∑–æ–Ω</label>
                                <select id="new-season" class="select">
                                    <option value="all">–í—Å–µ—Å–µ–∑–æ–Ω–Ω–∞—è</option>
                                    <option value="spring">–í–µ—Å–Ω–∞</option>
                                    <option value="summer">–õ–µ—Ç–æ</option>
                                    <option value="autumn">–û—Å–µ–Ω—å</option>
                                    <option value="winter">–ó–∏–º–∞</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label style="font-size: 13px; font-weight: 600; margin-bottom: 8px; display: block; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                            <input type="text" id="new-name" class="input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–∏–Ω—è—è —Ñ—É—Ç–±–æ–ª–∫–∞">
                        </div>

                        <div>
                            <label style="font-size: 13px; font-weight: 600; margin-bottom: 8px; display: block; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;">–¶–≤–µ—Ç</label>
                            <input type="text" id="new-color" class="input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–∏–Ω–∏–π">
                        </div>
                    </div>

                    <!-- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ -->
                    <div style="background: rgba(255, 255, 255, 0.5); padding: 24px; border-radius: 16px; margin-bottom: 32px;">
                        <div style="display: grid; gap: 24px;">
                            <div>
                                <label style="font-size: 14px; font-weight: 600; margin-bottom: 12px; display: block; color: var(--text-primary);">–¢–µ–ø–ª–æ—Ç–∞: <span id="warmth-value" style="color: var(--ocean-deep);">3</span>/5</label>
                                <input type="range" id="new-warmth" min="1" max="5" value="3" style="width: 100%; height: 8px; border-radius: 4px; background: linear-gradient(90deg, var(--ocean-light) 0%, var(--ocean-deep) 100%); outline: none; -webkit-appearance: none;" oninput="document.getElementById('warmth-value').textContent = this.value">
                            </div>

                            <div>
                                <label style="font-size: 14px; font-weight: 600; margin-bottom: 12px; display: block; color: var(--text-primary);">–§–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç—å: <span id="formality-value" style="color: var(--ocean-deep);">3</span>/5</label>
                                <input type="range" id="new-formality" min="1" max="5" value="3" style="width: 100%; height: 8px; border-radius: 4px; background: linear-gradient(90deg, var(--ocean-light) 0%, var(--ocean-deep) 100%); outline: none; -webkit-appearance: none;" oninput="document.getElementById('formality-value').textContent = this.value">
                            </div>

                            <label style="display: flex; align-items: center; gap: 12px; cursor: pointer; padding: 12px; background: rgba(186, 230, 253, 0.3); border-radius: 10px;">
                                <input type="checkbox" id="new-waterproof" style="width: 24px; height: 24px; cursor: pointer;">
                                <span style="font-weight: 500; color: var(--text-primary);">–í–æ–¥–æ–Ω–µ–ø—Ä–æ–Ω–∏—Ü–∞–µ–º–∞—è</span>
                            </label>
                        </div>
                    </div>

                    <!-- –§–æ—Ç–æ -->
                    <div style="margin-bottom: 32px;">
                        <label style="font-size: 13px; font-weight: 600; margin-bottom: 12px; display: block; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;">–§–æ—Ç–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>

                        <!-- –ü—Ä–µ–≤—å—é —Ñ–æ—Ç–æ -->
                        <div id="photo-preview" style="display: none; margin-bottom: 16px; text-align: center;">
                            <img id="photo-preview-img" style="max-width: 240px; max-height: 240px; border-radius: 16px; border: 2px solid var(--border-color); box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <div style="margin-top: 16px;">
                                <button class="btn-secondary" onclick="removePhoto()" style="background: #ef4444; padding: 12px 24px;">–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ</button>
                            </div>
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ -->
                        <div id="photo-buttons" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <label class="btn-secondary" style="padding: 16px; cursor: pointer; text-align: center; display: flex; align-items: center; justify-content: center; gap: 8px; background: linear-gradient(135deg, var(--ocean-light) 0%, var(--ocean-deep) 100%); color: white; border: none;">
                                <span>üì∑</span>
                                <span>–ö–∞–º–µ—Ä–∞</span>
                                <input type="file" id="photo-camera" accept="image/*" capture="environment" onchange="handlePhotoUpload(event)" style="display: none;">
                            </label>
                            <label class="btn-secondary" style="padding: 16px; cursor: pointer; text-align: center; display: flex; align-items: center; justify-content: center; gap: 8px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); color: white; border: none;">
                                <span>üñºÔ∏è</span>
                                <span>–ì–∞–ª–µ—Ä–µ—è</span>
                                <input type="file" id="photo-upload" accept="image/*" onchange="handlePhotoUpload(event)" style="display: none;">
                            </label>
                        </div>
                    </div>

                    <button class="btn-primary" onclick="addItem()" style="width: 100%; padding: 18px; font-size: 16px;">–î–æ–±–∞–≤–∏—Ç—å –≤ –≥–∞—Ä–¥–µ—Ä–æ–±</button>
                </div>

                <h3 style="color: var(--text-primary);">–í–∞—à –≥–∞—Ä–¥–µ—Ä–æ–±</h3>
                <div id="wardrobe-container" class="wardrobe-grid"></div>

                <!-- –ö–æ–º–±–æ-–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è -->
                <div style="margin-top: 56px; background: linear-gradient(135deg, rgba(186, 230, 253, 0.5) 0%, rgba(125, 211, 252, 0.4) 100%); padding: 32px; border-radius: 16px;">
                    <h4 style="color: var(--text-primary); margin-bottom: 12px;">–ö–æ–º–±–∏–Ω–∞—Ü–∏–∏ –≤–µ—â–µ–π</h4>
                    <p style="color: var(--text-secondary); margin-bottom: 20px; font-size: 15px; line-height: 1.6;">
                        –£–∑–Ω–∞–π—Ç–µ, –∫–∞–∫–∏–µ –≤–µ—â–∏ –ª—É—á—à–µ –≤—Å–µ–≥–æ —Å–æ—á–µ—Ç–∞—é—Ç—Å—è –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º
                    </p>
                    <button class="btn-primary" onclick="generateCombos()" style="width: 100%; font-size: 16px; padding: 16px;">
                        –ü–æ–¥–æ–±—Ä–∞—Ç—å –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
                    </button>
                    <div id="combos-container" style="margin-top: 20px;"></div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞: –®–æ–ø–∏–Ω–≥ -->
            <div id="tab-shop" class="tab-content hidden">
                <div style="text-align: center; margin-bottom: 48px;">
                    <h2 style="color: var(--text-primary);">–ü–æ–¥–±–æ—Ä —Ç–æ–≤–∞—Ä–æ–≤</h2>
                    <p style="color: var(--text-secondary); max-width: 600px; margin: 0 auto; font-size: 17px; line-height: 1.6;">
                        –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–µ–≥–æ –≥–∞—Ä–¥–µ—Ä–æ–±–∞ –∏ —Å—Ç–∏–ª—è
                    </p>
                </div>

                <div style="max-width: 500px; margin: 0 auto 48px;">
                    <label style="font-weight: 600; margin-bottom: 12px; display: block; color: var(--text-primary);">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select id="shop-category" class="select" style="margin-bottom: 24px;">
                        <option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        <option value="top">–í–µ—Ä—Ö</option>
                        <option value="bottom">–ù–∏–∑</option>
                        <option value="outerwear">–í–µ—Ä—Ö–Ω—è—è –æ–¥–µ–∂–¥–∞</option>
                        <option value="shoes">–û–±—É–≤—å</option>
                        <option value="accessory">–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</option>
                    </select>

                    <button class="btn-primary" onclick="generateShoppingRecommendations()" style="width: 100%; font-size: 17px; padding: 18px;">
                        –ü–æ–¥–æ–±—Ä–∞—Ç—å —Ç–æ–≤–∞—Ä—ã
                    </button>
                </div>

                <div id="shop-container"></div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞: –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Å—Ç–∏—Ä–∫–∏ -->
            <div id="tab-laundry" class="tab-content hidden">
                <div style="background: linear-gradient(135deg, rgba(224, 242, 254, 0.7) 0%, rgba(219, 234, 254, 0.7) 100%); padding: 32px; border-radius: 16px; margin-bottom: 32px;">
                    <h3 style="color: var(--text-primary);">–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∏—Ä–∫–∏</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 16px;">
                        <div>
                            <label style="font-weight: 600; margin-bottom: 8px; display: block; color: var(--text-primary);">–ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –æ–¥–µ–∂–¥–∞?</label>
                            <input type="date" id="target-date" class="input">
                        </div>
                        <div>
                            <label style="font-weight: 600; margin-bottom: 8px; display: block; color: var(--text-primary);">–¢–∏–ø –æ–¥–µ–∂–¥—ã</label>
                            <select id="laundry-type" class="select">
                                <option value="everyday">–ü–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–∞—è</option>
                                <option value="workout">–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è</option>
                                <option value="formal">–î–µ–ª–æ–≤–∞—è</option>
                                <option value="all">–í—Å—è</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn-primary" onclick="generateLaundryPlan()" style="width: 100%;">
                        –°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω —Å—Ç–∏—Ä–∫–∏
                    </button>
                </div>

                <div id="laundry-plan-container"></div>

                <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å—Ç–∏—Ä–∫–∏ -->
                <div style="background: var(--card-bg); border-radius: 12px; padding: 24px; margin-top: 24px; transition: all 0.3s ease;">
                    <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color: var(--text-primary);">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å—Ç–∏—Ä–∫–∏</h3>
                    <div id="laundry-calendar"></div>
                </div>

                <!-- –¢—Ä–µ–∫–∏–Ω–≥ –∫–∞–ø—Å—É–ª -->
                <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-radius: 12px; padding: 24px; margin-top: 24px; transition: all 0.3s ease;">
                    <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color: var(--text-primary);">üß¥ –°—Ç–∏—Ä–∞–ª—å–Ω—ã–µ –∫–∞–ø—Å—É–ª—ã</h3>

                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="flex: 1;">
                            <div style="font-size: 14px; color: #6b7280; margin-bottom: 8px;">–û—Å—Ç–∞–ª–æ—Å—å –∫–∞–ø—Å—É–ª</div>
                            <div id="capsules-count" style="font-size: 48px; font-weight: 700; color: #8b5cf6;">20</div>
                        </div>
                        <div style="text-align: center; padding: 0 20px;">
                            <div style="font-size: 14px; color: #6b7280; margin-bottom: 8px;">–•–≤–∞—Ç–∏—Ç –Ω–∞</div>
                            <div id="capsules-days" style="font-size: 24px; font-weight: 600; color: #059669;">~7 –¥–Ω–µ–π</div>
                        </div>
                    </div>

                    <div style="display: flex; justify-content: center;">
                        <button class="btn-primary" onclick="addCapsules()" style="background: #8b5cf6; padding: 14px; max-width: 250px;">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞–ø—Å—É–ª—ã
                        </button>
                    </div>

                    <div id="capsules-alert" style="margin-top: 16px; padding: 16px; background: #fef2f2; color: #dc2626; border-radius: 8px; font-weight: 600; display: none; animation: slideIn 0.3s ease-out;">
                        –ö–∞–ø—Å—É–ª—ã –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è! –û—Å—Ç–∞–ª–æ—Å—å –º–µ–Ω–µ–µ 5 —à—Ç—É–∫.
                    </div>
                </div>

                <!-- –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∏—Ä–æ–∫ -->
                <div style="background: var(--card-bg); border-radius: 12px; padding: 24px; margin-top: 24px; transition: all 0.3s ease;">
                    <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color: var(--text-primary);">üìú –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∏—Ä–æ–∫</h3>
                    <div id="laundry-history-container"></div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞: –ò—Å—Ç–æ—Ä–∏—è -->
            <div id="tab-history" class="tab-content hidden">
                <div style="text-align: center; margin-bottom: 32px;">
                    <h2 style="font-size: 28px; font-weight: bold; margin-bottom: 12px; color: var(--text-primary);">–ò—Å—Ç–æ—Ä–∏—è</h2>
                    <p style="color: var(--text-secondary);">–û–±—Ä–∞–∑—ã –∏ –ø–æ–≥–æ–¥–∞ –ø–æ –¥–Ω—è–º</p>
                </div>
                <div id="history-container"></div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div id="tab-stats" class="tab-content hidden">
                <div style="text-align: center; margin-bottom: 32px;">
                    <h2 style="font-size: 28px; font-weight: bold; margin-bottom: 12px; color: var(--text-primary);">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                    <p style="color: var(--text-secondary);">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–µ—â–µ–π</p>
                </div>
                <div id="stats-container"></div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞: –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –æ–±—Ä–∞–∑—ã -->
        </div>

        <!-- –§—É—Ç–µ—Ä -->
        <div class="text-center" style="background: rgba(255,255,255,0.5); padding: 16px; border-radius: 8px;">
            <p style="margin-bottom: 8px; font-size: 14px; color: var(--text-secondary);">
                <strong>–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ</strong> - –≤–∞—à –≥–∞—Ä–¥–µ—Ä–æ–± –Ω–µ –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è
            </p>
            <p style="font-size: 12px; color: var(--text-secondary); margin-bottom: 12px;">
                –ü–æ–≥–æ–¥–∞: Open-Meteo ‚Ä¢ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è: Nominatim/OpenStreetMap ‚Ä¢ AI: llm7.io
            </p>
            <p style="font-size: 11px; color: var(--text-secondary); opacity: 0.7; border-top: 1px solid var(--border-color); padding-top: 12px;">
                –ê–≤—Ç–æ—Ä –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –ò—Å–ø–æ–ª—å–∑—É—è —Å–µ—Ä–≤–∏—Å, –≤—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ –Ω–∞ —Å–µ–±—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –¥–∞–Ω–Ω—ã–µ.
            </p>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è -->
    <div id="reminders-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 style="font-size: 20px; font-weight: bold; color: var(--text-primary);">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</h3>
                <button class="icon-btn" onclick="hideRemindersModal()">‚úñÔ∏è</button>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="font-weight: 600; margin-bottom: 8px; display: block; color: var(--text-primary);">–¢–∏–ø –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</label>
                <select id="reminder-type" class="select" style="margin-bottom: 12px;">
                    <option value="laundry">–°—Ç–∏—Ä–∫–∞</option>
                    <option value="event">–°–æ–±—ã—Ç–∏–µ</option>
                    <option value="shopping">–®–æ–ø–∏–Ω–≥</option>
                    <option value="other">–î—Ä—É–≥–æ–µ</option>
                </select>

                <label style="font-weight: 600; margin-bottom: 8px; display: block; color: var(--text-primary);">–¢–µ–∫—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</label>
                <input type="text" id="reminder-text" class="input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ—Å—Ç–∏—Ä–∞—Ç—å —Å–ø–æ—Ä—Ç–∏–≤–Ω—É—é –æ–¥–µ–∂–¥—É" style="margin-bottom: 12px;">

                <label style="font-weight: 600; margin-bottom: 8px; display: block; color: var(--text-primary);">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</label>
                <input type="datetime-local" id="reminder-datetime" class="input" style="margin-bottom: 16px;">

                <button class="btn-primary" onclick="addReminder()" style="width: 100%;">
                    –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
                </button>
            </div>

            <div id="reminders-list" style="max-height: 300px; overflow-y: auto;"></div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ -->
    <div id="location-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 style="font-size: 20px; font-weight: bold; color: var(--text-primary);">–£–∫–∞–∑–∞—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</h3>
                <button class="icon-btn" onclick="hideLocationModal()">‚úñ</button>
            </div>

            <label style="display: block; font-weight: 600; margin-bottom: 12px; color: var(--text-primary);">–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞</label>
            <div style="display: flex; gap: 12px;">
                <input type="text" id="city-search" class="input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–æ—Å–∫–≤–∞, –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥" onkeypress="if(event.key==='Enter') searchCity()" style="flex: 1;">
                <button class="btn-primary" onclick="searchCity()" style="padding: 16px 24px;">–ù–∞–π—Ç–∏</button>
            </div>
        </div>
    </div>

    <script>
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let state = {
            wardrobe: [
                {
                    id: 1,
                    type: 'bottom',
                    name: '–°–∏–Ω–∏–µ –¥–∂–∏–Ω—Å—ã',
                    color: '–°–∏–Ω–∏–π',
                    warmth: 3,
                    formality: 3,
                    waterproof: false,
                    season: 'all',
                    photo: null
                },
                {
                    id: 2,
                    type: 'top',
                    name: '–ë–µ–ª–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞',
                    color: '–ë–µ–ª—ã–π',
                    warmth: 2,
                    formality: 2,
                    waterproof: false,
                    season: 'all',
                    photo: null
                },
                {
                    id: 3,
                    type: 'shoes',
                    name: '–ë–µ–ª—ã–µ –∫–µ–¥—ã',
                    color: '–ë–µ–ª—ã–π',
                    warmth: 2,
                    formality: 2,
                    waterproof: false,
                    season: 'all',
                    photo: null
                },
                {
                    id: 4,
                    type: 'top',
                    name: '–°–µ—Ä–∞—è –∫–æ—Ñ—Ç–∞',
                    color: '–°–µ—Ä—ã–π',
                    warmth: 4,
                    formality: 3,
                    waterproof: false,
                    season: 'all',
                    photo: null
                },
                {
                    id: 5,
                    type: 'top',
                    name: '–ë–µ–ª–æ–µ —Ö—É–¥–∏',
                    color: '–ë–µ–ª—ã–π',
                    warmth: 4,
                    formality: 2,
                    waterproof: false,
                    season: 'all',
                    photo: null
                }
            ],
            savedOutfits: [],
            location: null,
            locationName: '',
            weather: null,
            forecast: null,
            vibe: 'casual',
            occasion: '',
            ageGroup: '',
            preferredStyle: '',
            darkTheme: false,
            laundrySchedule: [],
            outfitHistory: [],
            reminders: [],
            capsules: parseInt(20), // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∏—Ä–∞–ª—å–Ω—ã—Ö –∫–∞–ø—Å—É–ª
            laundryHistory: [], // –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —Å—Ç–∏—Ä–æ–∫
            currentLaundryPlan: null // –¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω —Å—Ç–∏—Ä–∫–∏ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
        };

        // –¢–µ–∫—É—â–∏–µ –æ–±—Ä–∞–∑—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        let currentOutfits = [];

        // –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ç–æ –Ω–æ–≤–æ–π –≤–µ—â–∏
        let currentPhoto = null;

        // –¢–µ–º–Ω–∞—è —Ç–µ–º–∞
        function toggleTheme() {
            state.darkTheme = !state.darkTheme;
            document.body.classList.toggle('dark-theme');
            document.getElementById('theme-toggle').textContent = state.darkTheme ? '‚òÄÔ∏è' : 'üåô';
            saveToStorage();
        }

        function loadTheme() {
            if (state.darkTheme) {
                document.body.classList.add('dark-theme');
                document.getElementById('theme-toggle').textContent = '‚òÄÔ∏è';
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            loadFromStorage();
            loadTheme();
            renderWardrobe();
            renderSavedOutfits();
            updateCounts();
            updateCapsulesDisplay();

            if (state.location) {
                fetchWeather(state.location);
                updateLocationDisplay();
            }

            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
            scheduleReminderCheck();
            updateRemindersBadge();
        }

        // localStorage
        function loadFromStorage() {
            try {
                const saved = localStorage.getItem('wardrobeData');
                let needsResave = false;
                if (saved) {
                    const data = JSON.parse(saved);
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å—Ç–∞—Ä—ã–µ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ - –µ—Å–ª–∏ –¥–∞, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ —Ä—É—Å—Å–∫–∏–µ –¥–µ—Ñ–æ–ª—Ç—ã
                    if (data.wardrobe && data.wardrobe.length > 0) {
                        const hasEnglishData = data.wardrobe.some(item =>
                            /[a-zA-Z]/.test(item.name) && (
                                item.name.includes('White') ||
                                item.name.includes('Navy') ||
                                item.name.includes('Blue') ||
                                item.name.includes('Black') ||
                                item.name.includes('Leather') ||
                                item.name.includes('T-Shirt') ||
                                item.name.includes('Sweater') ||
                                item.name.includes('Jeans') ||
                                item.name.includes('Trousers') ||
                                item.name.includes('Jacket')
                            )
                        );

                        if (hasEnglishData) {
                            needsResave = true;
                        } else {
                            state.wardrobe = data.wardrobe;
                        }
                    }
                    state.savedOutfits = data.savedOutfits || [];
                    state.location = data.location || null;
                    state.locationName = data.locationName || '';
                    state.vibe = data.vibe || 'casual';
                    state.occasion = data.occasion || '';
                    state.ageGroup = data.ageGroup || '';
                    state.preferredStyle = data.preferredStyle || '';
                    state.laundrySchedule = data.laundrySchedule || [];
                    state.outfitHistory = data.outfitHistory || [];
                    state.reminders = data.reminders || [];
                    state.capsules = parseInt(data.capsules) || 20;
                    state.laundryHistory = data.laundryHistory || [];

                    document.getElementById('vibe-select').value = state.vibe;
                    document.getElementById('occasion-input').value = state.occasion;
                    if (document.getElementById('age-group')) {
                        document.getElementById('age-group').value = state.ageGroup;
                    }
                    if (document.getElementById('preferred-style')) {
                        document.getElementById('preferred-style').value = state.preferredStyle;
                    }
                }
                // –ï—Å–ª–∏ –±—ã–ª–∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ, —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä—É—Å—Å–∫–∏–µ –¥–µ—Ñ–æ–ª—Ç—ã
                if (needsResave) {
                    saveToStorage();
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
            }
        }

        function saveToStorage() {
            try {
                // –í—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º capsules –∫–∞–∫ —á–∏—Å–ª–æ
                const dataToSave = {
                    ...state,
                    capsules: parseInt(state.capsules) || 0
                };
                localStorage.setItem('wardrobeData', JSON.stringify(dataToSave));
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', e);
            }
        }

        function saveVibe() {
            state.vibe = document.getElementById('vibe-select').value;
            saveToStorage();
        }

        function saveOccasion() {
            state.occasion = document.getElementById('occasion-input').value;
            saveToStorage();
        }

        // –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è
        function savePersonalization() {
            state.ageGroup = document.getElementById('age-group').value;
            state.preferredStyle = document.getElementById('preferred-style').value;
            saveToStorage();
        }

        // –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
        function requestLocation() {
            if (!navigator.geolocation) {
                alert('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é');
                return;
            }

            document.getElementById('location-display').innerHTML = '<p>–û–ø—Ä–µ–¥–µ–ª—è—é –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ...</p>';

            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            };

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    state.location = {
                        lat: position.coords.latitude,
                        lon: position.coords.longitude
                    };
                    state.locationName = '–í–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ';
                    fetchWeather(state.location);
                    reverseGeocode(state.location);
                    saveToStorage();
                    updateLocationDisplay();
                },
                (error) => {
                    console.error('–û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:', error);
                    let errorMsg = '–û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è';

                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMsg = '–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â—ë–Ω';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMsg = '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ';
                            break;
                        case error.TIMEOUT:
                            errorMsg = '–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è';
                            break;
                    }

                    document.getElementById('location-display').innerHTML = `
                        <p style="color: #dc2626; margin-bottom: 8px;">${errorMsg}</p>
                        <button class="btn-secondary" onclick="showLocationModal()">üìç –£–∫–∞–∑–∞—Ç—å –≤—Ä—É—á–Ω—É—é</button>
                    `;
                },
                options
            );
        }

        async function reverseGeocode(loc) {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${loc.lat}&lon=${loc.lon}&format=json`);
                const data = await response.json();
                state.locationName = data.address?.city || data.address?.town || data.address?.village || '–í–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ';
                updateLocationDisplay();
                saveToStorage();
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è:', e);
            }
        }

        async function searchCity() {
            const city = document.getElementById('city-search').value.trim();
            if (!city) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞');
                return;
            }

            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '–ü–æ–∏—Å–∫...';

            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(city)}&format=json&limit=1`);
                const data = await response.json();

                if (data.length > 0) {
                    state.location = {
                        lat: parseFloat(data[0].lat),
                        lon: parseFloat(data[0].lon)
                    };
                    state.locationName = data[0].display_name.split(',')[0];
                    await fetchWeather(state.location);
                    saveToStorage();
                    updateLocationDisplay();
                    hideLocationModal();
                } else {
                    alert('–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ.');
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –≥–æ—Ä–æ–¥–∞:', e);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≥–æ—Ä–æ–¥–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        function updateLocationDisplay() {
            document.getElementById('location-display').innerHTML = `
                <div style="font-weight: bold; color: #065f46; margin-bottom: 4px;">${state.locationName}</div>
                <div style="font-size: 14px; color: #065f46;">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</div>
            `;
        }

        // –ü–æ–≥–æ–¥–∞
        async function fetchWeather(loc) {
            try {
                const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${loc.lat}&longitude=${loc.lon}&current=temperature_2m,precipitation,wind_speed_10m,weather_code&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,weather_code&timezone=auto&forecast_days=14`);
                const data = await response.json();
                state.weather = data.current;
                state.forecast = data.daily;
                updateWeatherDisplay();
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã:', e);
            }
        }

        function updateWeatherDisplay() {
            if (!state.weather) return;

            const temp = state.weather.temperature_2m;
            const precip = state.weather.precipitation;
            let emoji = '‚õÖ';
            if (precip > 0) emoji = 'üåßÔ∏è';
            else if (temp < 10) emoji = '‚ùÑÔ∏è';
            else if (temp > 25) emoji = '‚òÄÔ∏è';

            let forecastHTML = '';
            if (state.forecast && state.forecast.time) {
                forecastHTML = '<div style="margin-top: 12px; padding-top: 8px; border-top: 1px solid rgba(30, 58, 138, 0.2);">';
                for (let i = 0; i < 3; i++) {
                    const date = new Date(state.forecast.time[i]);
                    const dayName = i === 0 ? '–°–µ–≥–æ–¥–Ω—è' : date.toLocaleDateString('ru-RU', { weekday: 'short' });
                    const maxTemp = state.forecast.temperature_2m_max[i];
                    const minTemp = state.forecast.temperature_2m_min[i];
                    const rain = state.forecast.precipitation_sum[i];
                    forecastHTML += `
                        <div style="font-size: 12px; color: #1e40af; margin-bottom: 4px;">
                            ${dayName}: ${Math.round(minTemp)}-${Math.round(maxTemp)}¬∞C ${rain > 0 ? 'üåßÔ∏è' : ''}
                        </div>
                    `;
                }
                forecastHTML += '</div>';
            }

            document.getElementById('weather-display').innerHTML = `
                <div style="font-size: 24px; font-weight: bold; color: #1e3a8a; margin-bottom: 4px;">${emoji} ${temp}¬∞C</div>
                <div style="font-size: 14px; color: #1e40af;">–í–µ—Ç–µ—Ä: ${state.weather.wind_speed_10m} –∫–º/—á</div>
                ${precip > 0 ? `<div style="font-size: 14px; color: #1e40af;">–î–æ–∂–¥—å: ${precip}–º–º</div>` : ''}
                ${forecastHTML}
            `;
        }

        // –ì–∞—Ä–¥–µ—Ä–æ–±
        function addItem() {
            const name = document.getElementById('new-name').value;
            const color = document.getElementById('new-color').value;

            if (!name || !color) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–≤–µ—Ç –≤–µ—â–∏');
                return;
            }

            const item = {
                id: Date.now(),
                type: document.getElementById('new-type').value,
                name: name,
                color: color,
                warmth: parseInt(document.getElementById('new-warmth').value),
                formality: parseInt(document.getElementById('new-formality').value),
                waterproof: document.getElementById('new-waterproof').checked,
                season: document.getElementById('new-season').value,
                photo: currentPhoto || null
            };

            state.wardrobe.push(item);
            saveToStorage();
            renderWardrobe();
            updateCounts();

            // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
            document.getElementById('new-name').value = '';
            document.getElementById('new-color').value = '';
            document.getElementById('new-warmth').value = 3;
            document.getElementById('new-formality').value = 3;
            document.getElementById('new-waterproof').checked = false;
            document.getElementById('new-season').value = 'all';
            document.getElementById('warmth-value').textContent = '3';
            document.getElementById('formality-value').textContent = '3';
            removePhoto();
        }

        // –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ç–æ
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ (–º–∞–∫—Å 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º—É–º 5MB');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞
            if (!file.type.startsWith('image/')) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                // –ö–æ–º–ø—Ä–µ—Å—Å–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;

                    // –†–µ—Å–∞–π–∑ –µ—Å–ª–∏ –±–æ–ª—å—à–µ 800px
                    const maxSize = 800;
                    if (width > maxSize || height > maxSize) {
                        if (width > height) {
                            height = (height * maxSize) / width;
                            width = maxSize;
                        } else {
                            width = (width * maxSize) / height;
                            height = maxSize;
                        }
                    }

                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);

                    // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ base64 (–∫–∞—á–µ—Å—Ç–≤–æ 0.8)
                    currentPhoto = canvas.toDataURL('image/jpeg', 0.8);
                    displayPhotoPreview(currentPhoto);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);

            // –°–±—Ä–æ—Å input
            event.target.value = '';
        }

        function displayPhotoPreview(photoUrl) {
            document.getElementById('photo-preview-img').src = photoUrl;
            document.getElementById('photo-preview').style.display = 'block';
            document.getElementById('photo-buttons').style.display = 'none';
        }

        function removePhoto() {
            currentPhoto = null;
            document.getElementById('photo-preview').style.display = 'none';
            document.getElementById('photo-buttons').style.display = 'grid';
            document.getElementById('photo-url').value = '';
        }

        function deleteItem(id) {
            state.wardrobe = state.wardrobe.filter(item => item.id !== id);
            saveToStorage();
            renderWardrobe();
            updateCounts();
        }

        function renderWardrobe() {
            const container = document.getElementById('wardrobe-container');
            if (state.wardrobe.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">–ü–æ–∫–∞ –Ω–µ—Ç –≤–µ—â–µ–π. –î–æ–±–∞–≤—å—Ç–µ –æ–¥–µ–∂–¥—É –≤ –≥–∞—Ä–¥–µ—Ä–æ–±!</p>';
                return;
            }

            container.innerHTML = state.wardrobe.map(item => {
                const photoHtml = item.photo ? `
                    <div style="margin-bottom: 12px;">
                        <img src="${item.photo}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px;" alt="${item.name}">
                    </div>
                ` : '';

                const seasonEmoji = {
                    'spring': 'üå∏',
                    'summer': '‚òÄÔ∏è',
                    'autumn': 'üçÇ',
                    'winter': '‚ùÑÔ∏è',
                    'all': 'üîÑ'
                }[item.season || 'all'];

                const seasonText = {
                    'spring': '–í–µ—Å–Ω–∞',
                    'summer': '–õ–µ—Ç–æ',
                    'autumn': '–û—Å–µ–Ω—å',
                    'winter': '–ó–∏–º–∞',
                    'all': '–í—Å–µ—Å–µ–∑–æ–Ω'
                }[item.season || 'all'];

                const categoryName = {
                    'top': '–í–ï–†–•',
                    'bottom': '–ù–ò–ó',
                    'outerwear': '–í–ï–†–•–ù–Ø–Ø –û–î–ï–ñ–î–ê',
                    'shoes': '–û–ë–£–í–¨',
                    'accessory': '–ê–ö–°–ï–°–°–£–ê–†'
                }[item.type] || '–û–î–ï–ñ–î–ê';

                return `
                    <div class="wardrobe-item">
                        ${photoHtml ? photoHtml : `
                        <div style="margin-bottom: 20px; text-align: center; padding: 48px 24px; background: linear-gradient(135deg, rgba(14, 165, 233, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%); border-radius: 16px; border: 2px dashed var(--border-color);">
                            <div style="font-size: 15px; color: var(--text-primary); font-weight: 600; margin-bottom: 8px;">${categoryName}</div>
                            <div style="font-size: 13px; color: var(--text-secondary); font-weight: 500;">${item.name}</div>
                        </div>
                        `}
                        <div class="flex justify-between items-center mb-3">
                            <div style="font-size: 11px; font-weight: 700; color: var(--ocean-deep); text-transform: uppercase; letter-spacing: 0.5px;">${categoryName}</div>
                            <button class="icon-btn" onclick="deleteItem(${item.id})" style="color: #dc2626; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;">üóëÔ∏è</button>
                        </div>
                        <h4 style="font-weight: 700; margin-bottom: 16px; color: var(--text-primary); font-size: 18px;">${item.name}</h4>
                        <div style="font-size: 14px; color: var(--text-secondary); line-height: 1.8;">
                            <div style="margin-bottom: 12px; padding: 12px; background: var(--input-bg); border-radius: 10px;">
                                <span style="font-weight: 600; color: var(--text-primary);">–¶–≤–µ—Ç:</span> ${item.color}
                            </div>
                            <div class="flex gap-3 mb-3" style="flex-wrap: wrap;">
                                <span style="padding: 8px 12px; background: var(--input-bg); border-radius: 8px; font-size: 13px; font-weight: 600;">üå°Ô∏è –¢–µ–ø–ª–æ—Ç–∞ ${item.warmth}/5</span>
                                <span style="padding: 8px 12px; background: var(--input-bg); border-radius: 8px; font-size: 13px; font-weight: 600;">üëî –§–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç—å ${item.formality}/5</span>
                                ${item.waterproof ? '<span style="padding: 8px 12px; background: var(--input-bg); border-radius: 8px; font-size: 13px; font-weight: 600;">‚òî –í–æ–¥–æ–Ω–µ–ø—Ä–æ–Ω–∏—Ü–∞–µ–º–∞—è</span>' : ''}
                            </div>
                            <div style="margin-top: 8px; display: inline-block; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); padding: 8px 16px; border-radius: 10px; font-size: 13px; color: white; font-weight: 700;">
                                ${seasonEmoji} ${seasonText}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // –ö–æ–º–±–æ-–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
        async function generateCombos() {
            const container = document.getElementById('combos-container');

            if (state.wardrobe.length < 3) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 16px;">–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã 3 –≤–µ—â–∏ –≤ –≥–∞—Ä–¥–µ—Ä–æ–±</p>';
                return;
            }

            container.innerHTML = '<div style="text-align: center; padding: 24px;"><div class="spinner" style="border-color: #8b5cf6; border-top-color: transparent;"></div></div>';

            try {
                const wardrobeDesc = state.wardrobe.map(item =>
                    `${item.name} (${item.color}, ${item.type})`
                ).join('; ');

                const prompt = `–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª–∏—Å—Ç. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –≥–∞—Ä–¥–µ—Ä–æ–± –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ 5 —É–¥–∞—á–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –≤–µ—â–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ä–æ—à–æ —Å–æ—á–µ—Ç–∞—é—Ç—Å—è –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º.

–ì–ê–†–î–ï–†–û–ë:
${wardrobeDesc}

–ü–æ–¥–±–µ—Ä–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º:
- –°–æ—á–µ—Ç–∞–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤
- –ë–∞–ª–∞–Ω—Å —Å—Ç–∏–ª–µ–π
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ - –º–∞—Å—Å–∏–≤ –∏–∑ 5 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π:
[
  {
    "items": ["–≤–µ—â—å1", "–≤–µ—â—å2", "–≤–µ—â—å3"],
    "reason": "–ø–æ—á–µ–º—É —ç—Ç–∏ –≤–µ—â–∏ —Ö–æ—Ä–æ—à–æ —Å–æ—á–µ—Ç–∞—é—Ç—Å—è (1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ)"
  }
]`;

                const response = await fetch('https://api.llm7.io/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'gpt-5-mini',
                        messages: [{ role: 'user', content: prompt }],
                        temperature: 0.8
                    })
                });

                const data = await response.json();
                let content = data.choices[0].message.content;
                content = content.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();

                const combos = JSON.parse(content);

                container.innerHTML = `
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        ${combos.map((combo, idx) => `
                            <div style="background: var(--card-bg); padding: 16px; border-radius: 10px; transition: all 0.3s ease; border: 1px solid var(--border-color);">
                                <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">
                                    –ö–æ–º–±–æ #${idx + 1}
                                </div>
                                <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 10px;">
                                    ${combo.items.map(item => `
                                        <span style="background: var(--tab-inactive-bg); padding: 6px 10px; border-radius: 6px; font-size: 13px; color: var(--text-primary);">
                                            ${item}
                                        </span>
                                    `).join('')}
                                </div>
                                <div style="font-size: 13px; color: var(--text-secondary); font-style: italic;">
                                    ${combo.reason}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;

            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–º–±–æ:', e);
                container.innerHTML = '<p style="color: #dc2626; text-align: center;">–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–±–æ—Ä–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π</p>';
            }
        }

        // –ü–æ–¥–±–æ—Ä –æ–±—Ä–∞–∑–æ–≤
        async function generateOutfits() {
            if (state.wardrobe.length < 3) {
                document.getElementById('generate-error').textContent = '–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã 3 –≤–µ—â–∏ –≤ –≥–∞—Ä–¥–µ—Ä–æ–±!';
                return;
            }
            if (!state.location) {
                document.getElementById('generate-error').textContent = '–°–Ω–∞—á–∞–ª–∞ —É–∫–∞–∂–∏—Ç–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ!';
                return;
            }

            document.getElementById('generate-error').textContent = '';
            const btn = document.getElementById('generate-btn');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> –ü–æ–¥–±–∏—Ä–∞—é –æ–±—Ä–∞–∑—ã...';

            try {
                const weatherDesc = state.weather
                    ? `–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${state.weather.temperature_2m}¬∞C, –í–µ—Ç–µ—Ä: ${state.weather.wind_speed_10m} –∫–º/—á, –û—Å–∞–¥–∫–∏: ${state.weather.precipitation}–º–º`
                    : '–£–º–µ—Ä–µ–Ω–Ω–∞—è –ø–æ–≥–æ–¥–∞';

                const wardrobeDesc = state.wardrobe.map(item =>
                    `${item.name} (${item.type}, ${item.color}, —Ç–µ–ø–ª–æ—Ç–∞:${item.warmth}/5, —Ñ–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç—å:${item.formality}/5${item.waterproof ? ', –≤–æ–¥–æ–Ω–µ–ø—Ä–æ–Ω–∏—Ü–∞–µ–º–∞—è' : ''})`
                ).join('; ');

                const personalContext = state.ageGroup && state.preferredStyle ?
                    `\n–ü–ï–†–°–û–ù–ê–õ–¨–ù–´–ï –ü–†–ï–î–ü–û–ß–¢–ï–ù–ò–Ø: –í–æ–∑—Ä–∞—Å—Ç ${state.ageGroup}, –°—Ç–∏–ª—å: ${state.preferredStyle}` : '';

                const prompt = `–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª–∏—Å—Ç. –ù–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–µ–¥–ª–æ–∂–∏ 3 –≥–æ—Ç–æ–≤—ã—Ö –æ–±—Ä–∞–∑–∞ –∏–∑ –∏–º–µ—é—â–µ–≥–æ—Å—è –≥–∞—Ä–¥–µ—Ä–æ–±–∞.

–ü–û–ì–û–î–ê: ${weatherDesc}
–ù–ê–°–¢–†–û–ï–ù–ò–ï/–°–û–ë–´–¢–ò–ï: ${state.vibe}${state.occasion ? ` - ${state.occasion}` : ''}${personalContext}

–î–û–°–¢–£–ü–ù–´–ô –ì–ê–†–î–ï–†–û–ë:
${wardrobeDesc}

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û JSON-–º–∞—Å—Å–∏–≤–æ–º –∏–∑ 3 –æ–±—Ä–∞–∑–æ–≤. –ö–∞–∂–¥—ã–π –æ–±—Ä–∞–∑ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
- "items": –º–∞—Å—Å–∏–≤ –Ω–∞–∑–≤–∞–Ω–∏–π –≤–µ—â–µ–π –∏–∑ –≥–∞—Ä–¥–µ—Ä–æ–±–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ: 1 –≤–µ—Ä—Ö, 1 –Ω–∏–∑, 1 –æ–±—É–≤—å. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –≤–µ—Ä—Ö–Ω—è—è –æ–¥–µ–∂–¥–∞, –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã)
- "rationale": –æ–¥–Ω–æ –∫–æ—Ä–æ—Ç–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, –ø–æ—á–µ–º—É —ç—Ç–æ—Ç –æ–±—Ä–∞–∑ —Ä–∞–±–æ—Ç–∞–µ—Ç

–§–æ—Ä–º–∞—Ç: [{"items": ["–≤–µ—â—å1", "–≤–µ—â—å2", ...], "rationale": "..."}, ...]`;

                const response = await fetch('https://api.llm7.io/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'gpt-5-mini',
                        messages: [{ role: 'user', content: prompt }],
                        temperature: 0.8
                    })
                });

                const data = await response.json();
                let content = data.choices[0].message.content;
                content = content.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();

                const outfits = JSON.parse(content);
                currentOutfits = outfits;
                renderOutfits(outfits);
                switchTab('results');
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:', e);
                const fallback = generateFallbackOutfits();
                currentOutfits = fallback;
                renderOutfits(fallback);
                switchTab('results');
            }

            btn.disabled = false;
            btn.innerHTML = '‚ú® –ü–æ–¥–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã';
        }

        function generateFallbackOutfits() {
            const tops = state.wardrobe.filter(i => i.type === 'top');
            const bottoms = state.wardrobe.filter(i => i.type === 'bottom');
            const shoes = state.wardrobe.filter(i => i.type === 'shoes');
            const outerwear = state.wardrobe.filter(i => i.type === 'outerwear');

            const combos = [];
            for (let i = 0; i < Math.min(3, tops.length); i++) {
                const outfit = {
                    items: [
                        tops[i % tops.length]?.name,
                        bottoms[i % bottoms.length]?.name,
                        shoes[i % shoes.length]?.name
                    ].filter(Boolean),
                    rationale: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤'
                };
                if (outerwear.length > 0 && state.weather?.temperature_2m < 15) {
                    outfit.items.push(outerwear[0].name);
                }
                combos.push(outfit);
            }
            return combos;
        }

        // –°–≤–∞–π–ø—ã
        let touchStartX = 0;
        let touchEndX = 0;
        let currentOutfitIndex = 0;

        function handleSwipe(container) {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;

            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0 && currentOutfitIndex < currentOutfits.length - 1) {
                    // –°–≤–∞–π–ø –≤–ª–µ–≤–æ - —Å–ª–µ–¥—É—é—â–∏–π
                    currentOutfitIndex++;
                    updateOutfitView();
                } else if (diff < 0 && currentOutfitIndex > 0) {
                    // –°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ - –ø—Ä–µ–¥—ã–¥—É—â–∏–π
                    currentOutfitIndex--;
                    updateOutfitView();
                }
            }
        }

        function updateOutfitView() {
            const container = document.getElementById('outfits-container');
            container.style.transform = `translateX(-${currentOutfitIndex * 100}%)`;

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
            document.querySelectorAll('.outfit-indicator').forEach((dot, idx) => {
                dot.style.opacity = idx === currentOutfitIndex ? '1' : '0.3';
            });
        }

        function renderOutfits(outfits) {
            const container = document.getElementById('outfits-container');
            currentOutfitIndex = 0;

            // –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å–æ —Å–≤–∞–π–ø–∞–º–∏
            if (window.innerWidth < 768) {
                const wrapper = document.createElement('div');
                wrapper.style.overflow = 'hidden';
                wrapper.style.position = 'relative';

                wrapper.innerHTML = `
                    <div id="outfits-container" style="display: flex; transition: transform 0.3s ease; width: 100%;">
                        ${outfits.map((outfit, idx) => `
                            <div class="outfit-card" style="min-width: 100%; flex-shrink: 0;">
                                <div style="font-size: 24px; font-weight: bold; color: #7c3aed; margin-bottom: 12px;">
                                    –û–±—Ä–∞–∑ ${idx + 1} –∏–∑ ${outfits.length}
                                </div>
                                <div style="margin-bottom: 16px;">
                                    ${outfit.items.map(item => `<div class="outfit-item">${item}</div>`).join('')}
                                </div>
                                <div style="font-size: 14px; color: var(--text-primary); font-style: italic; padding: 12px; background: var(--card-bg); border-radius: 8px; margin-bottom: 16px; transition: all 0.3s ease;">
                                    "${outfit.rationale}"
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div style="display: flex; justify-content: center; gap: 8px; margin-top: 16px;">
                        ${outfits.map((_, idx) => `
                            <div class="outfit-indicator" style="width: 8px; height: 8px; border-radius: 50%; background: #8b5cf6; opacity: ${idx === 0 ? '1' : '0.3'}; transition: opacity 0.3s;"></div>
                        `).join('')}
                    </div>
                `;

                container.parentElement.innerHTML = '';
                container.parentElement.appendChild(wrapper);

                const outfitsContainer = document.getElementById('outfits-container');
                outfitsContainer.addEventListener('touchstart', e => {
                    touchStartX = e.changedTouches[0].screenX;
                }, { passive: true });

                outfitsContainer.addEventListener('touchend', e => {
                    touchEndX = e.changedTouches[0].screenX;
                    handleSwipe(outfitsContainer);
                }, { passive: true });

            } else {
                // –î–µ—Å–∫—Ç–æ–ø–Ω–∞—è –≤–µ—Ä—Å–∏—è - —Å–µ—Ç–∫–∞
                container.innerHTML = outfits.map((outfit, idx) => `
                    <div class="outfit-card">
                        <div style="font-size: 24px; font-weight: bold; color: #7c3aed; margin-bottom: 12px;">
                            –û–±—Ä–∞–∑ #${idx + 1}
                        </div>
                        <div style="margin-bottom: 16px;">
                            ${outfit.items.map(item => `<div class="outfit-item">${item}</div>`).join('')}
                        </div>
                        <div style="font-size: 14px; color: var(--text-primary); font-style: italic; padding: 12px; background: var(--card-bg); border-radius: 8px; margin-bottom: 16px; transition: all 0.3s ease;">
                            "${outfit.rationale}"
                        </div>
                    </div>
                `).join('');
            }
        }

        function saveOutfit(index) {
            const outfit = currentOutfits[index];
            const savedOutfit = {
                ...outfit,
                id: Date.now(),
                savedAt: new Date().toISOString()
            };

            state.savedOutfits.push(savedOutfit);

            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
            state.outfitHistory.push({
                id: Date.now(),
                date: new Date().toISOString(),
                outfit: outfit,
                weather: state.weather ? {
                    temp: state.weather.temperature_2m,
                    precipitation: state.weather.precipitation,
                    wind: state.weather.wind_speed_10m
                } : null,
                location: state.locationName
            });

            saveToStorage();
            renderSavedOutfits();
            updateCounts();
            alert('–û–±—Ä–∞–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω! ‚ù§Ô∏è');
        }

        let currentShareBlob = null;

        async function shareOutfit(index) {
            const outfit = currentOutfits[index];

            // –°–æ–∑–¥–∞—ë–º canvas –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏ (–≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ)
            const canvas = document.createElement('canvas');
            canvas.width = 1080;  // Instagram Stories format
            canvas.height = 1920;
            const ctx = canvas.getContext('2d');

            // –í–∫–ª—é—á–∞–µ–º —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';

            // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#fff1f2');
            gradient.addColorStop(0.3, '#fef3c7');
            gradient.addColorStop(0.7, '#dbeafe');
            gradient.addColorStop(1, '#fce7f3');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            ctx.globalAlpha = 0.08;
            ctx.fillStyle = '#f43f5e';
            ctx.beginPath();
            ctx.arc(150, 250, 450, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#fbbf24';
            ctx.beginPath();
            ctx.arc(930, 1600, 400, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#8b5cf6';
            ctx.beginPath();
            ctx.arc(540, 960, 300, 0, Math.PI * 2);
            ctx.fill();
            ctx.globalAlpha = 1;

            // –ì–ª–∞–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞
            ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
            ctx.shadowColor = 'rgba(0, 0, 0, 0.12)';
            ctx.shadowBlur = 50;
            ctx.shadowOffsetY = 25;
            roundRect(ctx, 60, 180, 960, 1400, 48);
            ctx.fill();
            ctx.shadowBlur = 0;
            ctx.shadowOffsetY = 0;

            // –ó–∞–≥–æ–ª–æ–≤–æ–∫
            ctx.fillStyle = '#18181b';
            ctx.font = 'bold 80px -apple-system, BlinkMacSystemFont, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('–ú–æ–π –æ–±—Ä–∞–∑', 540, 340);

            // –î–∞—Ç–∞ –∏ –ø–æ–≥–æ–¥–∞
            const today = new Date().toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            ctx.font = '38px -apple-system, sans-serif';
            ctx.fillStyle = '#71717a';
            ctx.fillText(today, 540, 410);

            if (state.weather && state.locationName) {
                ctx.fillText(`${Math.round(state.weather.temperature_2m)}¬∞C ‚Ä¢ ${state.locationName}`, 540, 475);
            } else if (state.weather) {
                ctx.fillText(`${Math.round(state.weather.temperature_2m)}¬∞C`, 540, 475);
            }

            // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
            ctx.strokeStyle = 'rgba(244, 63, 94, 0.2)';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(180, 540);
            ctx.lineTo(900, 540);
            ctx.stroke();

            // –í–µ—â–∏
            let yPos = 650;
            ctx.textAlign = 'left';

            outfit.items.forEach((item, idx) => {
                // –§–æ–Ω –¥–ª—è –∫–∞–∂–¥–æ–π –≤–µ—â–∏
                ctx.fillStyle = 'rgba(244, 63, 94, 0.06)';
                roundRect(ctx, 120, yPos - 58, 840, 100, 24);
                ctx.fill();

                // –ù–æ–º–µ—Ä
                ctx.fillStyle = '#f43f5e';
                ctx.font = 'bold 44px -apple-system, sans-serif';
                ctx.fillText(`${idx + 1}`, 160, yPos);

                // –ù–∞–∑–≤–∞–Ω–∏–µ –≤–µ—â–∏
                ctx.fillStyle = '#18181b';
                ctx.font = '42px -apple-system, sans-serif';

                // –û–±—Ä–µ–∑–∞–µ–º –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
                let itemText = item;
                const maxItemWidth = 720;
                while (ctx.measureText(itemText).width > maxItemWidth && itemText.length > 0) {
                    itemText = itemText.substring(0, itemText.length - 1);
                }
                if (itemText.length < item.length) itemText += '...';

                ctx.fillText(itemText, 250, yPos);

                yPos += 130;
            });

            // –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å –º–µ—Å—Ç–æ)
            if (yPos < 1350) {
                yPos += 30;
                ctx.fillStyle = '#71717a';
                ctx.font = 'italic 34px -apple-system, sans-serif';
                ctx.textAlign = 'center';
                const maxWidth = 800;
                const words = outfit.rationale.split(' ');
                let line = '';
                let lines = [];

                for (let word of words) {
                    const testLine = line + word + ' ';
                    const metrics = ctx.measureText(testLine);
                    if (metrics.width > maxWidth && line !== '') {
                        lines.push(line);
                        line = word + ' ';
                    } else {
                        line = testLine;
                    }
                }
                if (line) lines.push(line);

                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫
                lines = lines.slice(0, 4);
                lines.forEach(line => {
                    if (yPos < 1450) {
                        ctx.fillText(line, 540, yPos);
                        yPos += 52;
                    }
                });
            }

            // –ë—Ä–µ–Ω–¥–∏–Ω–≥ –≤–Ω–∏–∑—É
            ctx.fillStyle = '#18181b';
            ctx.font = 'bold 52px -apple-system, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('–£–º–Ω—ã–π –≥–∞—Ä–¥–µ—Ä–æ–±', 540, 1680);

            ctx.font = '36px -apple-system, sans-serif';
            ctx.fillStyle = '#71717a';
            ctx.fillText('–¢–≤–æ–π AI-—Å—Ç–∏–ª–∏—Å—Ç –∫–∞–∂–¥—ã–π –¥–µ–Ω—å', 540, 1750);

            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ blob –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É
            canvas.toBlob((blob) => {
                currentShareBlob = blob;
                const url = URL.createObjectURL(blob);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º preview
                document.getElementById('share-preview').src = url;
                showShareModal();

                // –ù–∞–≤–µ—à–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É
                document.getElementById('share-download-btn').onclick = () => downloadImage(blob, url);
            }, 'image/png', 1.0); // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
        }

        function showShareModal() {
            document.getElementById('share-modal').classList.add('show');
        }

        function hideShareModal() {
            document.getElementById('share-modal').classList.remove('show');
            if (currentShareBlob) {
                URL.revokeObjectURL(document.getElementById('share-preview').src);
                currentShareBlob = null;
            }
        }

        function downloadImage(blob, url) {
            const a = document.createElement('a');
            a.href = url;
            a.download = `outfit-${Date.now()}.png`;
            a.click();
            hideShareModal();
        }

        function roundRect(ctx, x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
        }

        function renderHistory() {
            const container = document.getElementById('history-container');

            if (state.outfitHistory.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 48px; color: var(--text-secondary);">
                        <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;">üìä</div>
                        <p>–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞. –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –æ–±—Ä–∞–∑—ã, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é!</p>
                    </div>
                `;
                return;
            }

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            const sorted = [...state.outfitHistory].sort((a, b) => new Date(b.date) - new Date(a.date));

            container.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 16px;">
                    ${sorted.map(entry => {
                        const date = new Date(entry.date);
                        const dateStr = date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' });
                        const timeStr = date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });

                        let weatherHTML = '';
                        if (entry.weather) {
                            const emoji = entry.weather.precipitation > 0 ? 'üåßÔ∏è' :
                                         entry.weather.temp < 10 ? '‚ùÑÔ∏è' :
                                         entry.weather.temp > 25 ? '‚òÄÔ∏è' : '‚õÖ';
                            weatherHTML = `
                                <div style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: var(--text-secondary);">
                                    <span style="font-size: 20px;">${emoji}</span>
                                    <span>${entry.weather.temp}¬∞C</span>
                                    ${entry.weather.precipitation > 0 ? `<span>üíß${entry.weather.precipitation}–º–º</span>` : ''}
                                </div>
                            `;
                        }

                        return `
                            <div style="background: var(--card-bg); border-radius: 12px; padding: 20px; transition: all 0.3s ease; border: 1px solid var(--border-color);">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                                    <div>
                                        <div style="font-weight: 600; font-size: 16px; color: var(--text-primary); margin-bottom: 4px;">
                                            ${dateStr}
                                        </div>
                                        <div style="font-size: 13px; color: var(--text-secondary);">
                                            ${timeStr} ‚Ä¢ ${entry.location || '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
                                        </div>
                                    </div>
                                    ${weatherHTML}
                                </div>

                                <div style="background: var(--tab-inactive-bg); padding: 16px; border-radius: 10px;">
                                    <div style="font-weight: 600; margin-bottom: 12px; color: var(--text-primary);">–û–±—Ä–∞–∑:</div>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                        ${entry.outfit.items.map(item => `
                                            <div style="background: var(--card-bg); padding: 8px 12px; border-radius: 6px; font-size: 14px; color: var(--text-primary);">
                                                ${item}
                                            </div>
                                        `).join('')}
                                    </div>
                                    ${entry.outfit.rationale ? `
                                        <div style="margin-top: 12px; font-size: 13px; color: var(--text-secondary); font-style: italic;">
                                            "${entry.outfit.rationale}"
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function renderSavedOutfits() {
            const container = document.getElementById('saved-container');
            if (state.savedOutfits.length === 0) {
                container.innerHTML = `
                    <div class="text-center" style="padding: 48px 0; color: var(--text-secondary);">
                        <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;">‚ù§Ô∏è</div>
                        <p>–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤. –ü–æ–¥–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑—ã –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–µ—Å—è!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `<div class="outfit-grid">${state.savedOutfits.map(outfit => `
                <div style="background: linear-gradient(135deg, #fce7f3 0%, #faf5ff 100%); border-radius: 12px; padding: 24px; border: 2px solid #fbcfe8;">
                    <div class="flex justify-between items-center mb-3">
                        <span style="color: #ec4899; font-size: 20px;">‚ù§Ô∏è</span>
                        <span style="font-size: 12px; color: var(--text-secondary);">${new Date(outfit.savedAt).toLocaleDateString('ru-RU')}</span>
                    </div>
                    <div style="margin-bottom: 16px;">
                        ${outfit.items.map(item => `<div style="background: var(--card-bg); padding: 8px; border-radius: 8px; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: var(--text-primary); transition: all 0.3s ease;">${item}</div>`).join('')}
                    </div>
                    <div style="font-size: 12px; color: var(--text-primary); font-style: italic; padding: 8px; background: var(--card-bg); border-radius: 8px; transition: all 0.3s ease;">
                        "${outfit.rationale}"
                    </div>
                </div>
            `).join('')}</div>`;
        }

        // –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å—Ç–∏—Ä–∫–∏
        function renderLaundryCalendar() {
            const container = document.getElementById('laundry-calendar');
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();

            // –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startDay = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1; // –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ = 0

            const monthNames = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
            const dayNames = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];

            let calendarHTML = `
                <div style="margin-bottom: 16px; display: flex; justify-content: center; align-items: center; gap: 12px;">
                    <h4 style="font-size: 18px; font-weight: 600; color: var(--text-primary);">${monthNames[currentMonth]} ${currentYear}</h4>
                </div>

                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 8px;">
                    ${dayNames.map(day => `
                        <div style="text-align: center; font-weight: 600; font-size: 12px; color: var(--text-secondary); padding: 8px;">
                            ${day}
                        </div>
                    `).join('')}
                </div>

                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px;">
            `;

            // –ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –¥–æ –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—Ü–∞
            for (let i = 0; i < startDay; i++) {
                calendarHTML += '<div></div>';
            }

            // –î–Ω–∏ –º–µ—Å—è—Ü–∞
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(currentYear, currentMonth, day);
                const dateStr = date.toISOString().split('T')[0];
                const isToday = day === today.getDate() && currentMonth === today.getMonth();
                const isPast = date < today && !isToday;

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∏—Ä–∫–∞
                const laundryItem = state.laundrySchedule.find(item => item.date === dateStr);

                let bgColor = 'var(--card-bg)';
                let textColor = 'var(--text-primary)';
                let borderColor = 'var(--border-color)';
                let emoji = '';

                if (isToday) {
                    borderColor = '#8b5cf6';
                    bgColor = 'linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%)';
                }

                if (laundryItem) {
                    bgColor = 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)';
                    emoji = 'üß∫';
                    borderColor = '#3b82f6';
                }

                if (isPast) {
                    textColor = 'var(--text-secondary)';
                }

                calendarHTML += `
                    <div onclick="toggleLaundryDate('${dateStr}')"
                         style="background: ${bgColor}; border: 2px solid ${borderColor}; border-radius: 8px; padding: 12px; text-align: center; cursor: pointer; transition: all 0.2s; position: relative; min-height: 60px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                        <div style="font-weight: ${isToday ? '700' : '500'}; color: ${textColor}; font-size: 14px;">
                            ${day}
                        </div>
                        ${emoji ? `<div style="font-size: 18px; margin-top: 4px;">${emoji}</div>` : ''}
                        ${laundryItem ? `<div style="font-size: 9px; color: #1e40af; margin-top: 2px; font-weight: 600;">${laundryItem.type || '–°—Ç–∏—Ä–∫–∞'}</div>` : ''}
                    </div>
                `;
            }

            calendarHTML += '</div>';

            // –õ–µ–≥–µ–Ω–¥–∞
            calendarHTML += `
                <div style="margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border-color); display: flex; gap: 16px; flex-wrap: wrap; font-size: 12px;">
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <div style="width: 20px; height: 20px; background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%); border: 2px solid #8b5cf6; border-radius: 4px;"></div>
                        <span style="color: var(--text-secondary);">–°–µ–≥–æ–¥–Ω—è</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <div style="width: 20px; height: 20px; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border: 2px solid #3b82f6; border-radius: 4px;"></div>
                        <span style="color: var(--text-secondary);">–°—Ç–∏—Ä–∫–∞ üß∫</span>
                    </div>
                </div>
            `;

            container.innerHTML = calendarHTML;
        }

        function toggleLaundryDate(dateStr) {
            const index = state.laundrySchedule.findIndex(item => item.date === dateStr);

            if (index >= 0) {
                // –£–¥–∞–ª—è–µ–º
                state.laundrySchedule.splice(index, 1);
            } else {
                // –î–æ–±–∞–≤–ª—è–µ–º
                const laundryType = prompt('–¢–∏–ø —Å—Ç–∏—Ä–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–∞—è, —Å–ø–æ—Ä—Ç–∏–≤–Ω–∞—è, –¥–µ–ª–æ–≤–∞—è):') || '–°—Ç–∏—Ä–∫–∞';

                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–ø—Å—É–ª—É
                if (state.capsules > 0) {
                    state.capsules--;
                    updateCapsulesDisplay();
                } else {
                    if (!confirm('–ö–∞–ø—Å—É–ª—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å! –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∏—Ä–∫—É –≤—Å—ë —Ä–∞–≤–Ω–æ?')) {
                        return;
                    }
                }

                state.laundrySchedule.push({
                    date: dateStr,
                    type: laundryType,
                    createdAt: new Date().toISOString()
                });

                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é —Å—Ç–∏—Ä–æ–∫
                addToLaundryHistory(dateStr, laundryType);
                renderLaundryHistory();
            }

            saveToStorage();
            renderLaundryCalendar();
        }

        // –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∏—Ä–∫–∏
        async function generateLaundryPlan() {
            const targetDate = document.getElementById('target-date').value;
            const laundryType = document.getElementById('laundry-type').value;

            if (!targetDate) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É!');
                return;
            }

            if (!state.forecast) {
                alert('–°–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–∞ –ø–æ–≥–æ–¥—ã!');
                return;
            }

            const container = document.getElementById('laundry-plan-container');
            container.innerHTML = '<div style="text-align: center; padding: 24px;"><div class="spinner" style="border-color: #8b5cf6; border-top-color: transparent;"></div> –°–æ–∑–¥–∞—é –ø–ª–∞–Ω...</div>';

            try {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const target = new Date(targetDate);
                target.setHours(0, 0, 0, 0);
                const daysUntil = Math.ceil((target - today) / (1000 * 60 * 60 * 24));

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç–∞ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ø—Ä–æ–≥–Ω–æ–∑–∞ (14 –¥–Ω–µ–π)
                if (daysUntil > 14) {
                    container.innerHTML = '<div style="background: #fef2f2; color: #dc2626; padding: 16px; border-radius: 8px;">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 14 –¥–Ω–µ–π –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∞ –ø–æ–≥–æ–¥—ã.</div>';
                    return;
                }

                if (daysUntil < 0) {
                    container.innerHTML = '<div style="background: #fef2f2; color: #dc2626; padding: 16px; border-radius: 8px;">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –≤ –±—É–¥—É—â–µ–º.</div>';
                    return;
                }

                // –ë–µ—Ä–µ–º –ø—Ä–æ–≥–Ω–æ–∑ –¥–æ —Ü–µ–ª–µ–≤–æ–π –¥–∞—Ç—ã (–∏–ª–∏ –≤—Å–µ 14 –¥–Ω–µ–π, –µ—Å–ª–∏ –¥–∞—Ç–∞ –¥–∞–ª—å—à–µ)
                const forecastDays = Math.min(daysUntil + 2, state.forecast.time.length);
                const weatherInfo = state.forecast ?
                    state.forecast.time.slice(0, forecastDays).map((d, i) => {
                        const date = new Date(d);
                        return `${date.toLocaleDateString('ru-RU', {day: 'numeric', month: 'short', weekday: 'short'})}: ${Math.round(state.forecast.temperature_2m_min[i])}-${Math.round(state.forecast.temperature_2m_max[i])}¬∞C${state.forecast.precipitation_sum[i] > 0 ? ', –¥–æ–∂–¥—å ' + state.forecast.precipitation_sum[i] + '–º–º' : ', –±–µ–∑ –æ—Å–∞–¥–∫–æ–≤'}`;
                    }).join('\n') : '–ü—Ä–æ–≥–Ω–æ–∑ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';

                const wardrobeInfo = state.wardrobe.map(item =>
                    `${item.name} (${item.type}, —Ç–µ–ø–ª–æ:${item.warmth}/5, —Ñ–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç—å:${item.formality}/5${item.waterproof ? ', –≤–æ–¥–æ—Å—Ç–æ–π–∫–∞—è' : ''})`
                ).join('; ');

                const personalInfo = `–í–æ–∑—Ä–∞—Å—Ç: ${state.ageGroup || '–Ω–µ —É–∫–∞–∑–∞–Ω'}, –°—Ç–∏–ª—å: ${state.preferredStyle || '–Ω–µ —É–∫–∞–∑–∞–Ω'}`;

                const prompt = `–¢—ã - —É–º–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é —Å—Ç–∏—Ä–∫–∏. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ —Å–æ–∑–¥–∞–π –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Å—Ç–∏—Ä–∫–∏.

–ü–ï–†–°–û–ù–ê–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø:
${personalInfo}

–ü–†–û–ì–ù–û–ó –ü–û–ì–û–î–´ (–¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—Ç—ã):
${weatherInfo}

–ì–ê–†–î–ï–†–û–ë:
${wardrobeInfo}

–ó–ê–î–ê–ß–ê:
- –¢–∏–ø –æ–¥–µ–∂–¥—ã –¥–ª—è —Å—Ç–∏—Ä–∫–∏: ${laundryType === 'all' ? '–≤—Å—è' : laundryType === 'everyday' ? '–ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–∞—è' : laundryType === 'workout' ? '—Å–ø–æ—Ä—Ç–∏–≤–Ω–∞—è' : '–¥–µ–ª–æ–≤–∞—è'}
- –û–¥–µ–∂–¥–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≥–æ—Ç–æ–≤–∞ –∫: ${new Date(targetDate).toLocaleDateString('ru-RU', { weekday: 'long', day: 'numeric', month: 'long' })}
- –î–Ω–µ–π –¥–æ —Ü–µ–ª–µ–≤–æ–π –¥–∞—Ç—ã: ${daysUntil}

–í–ê–ñ–ù–û:
1. –í—ã–±–µ—Ä–∏ –ö–û–ù–ö–†–ï–¢–ù–´–ï –î–ê–¢–´ –∏–∑ –ø—Ä–æ–≥–Ω–æ–∑–∞ –≤—ã—à–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä "4 —è–Ω–≤., –ø—Ç" –∏–ª–∏ "15 –¥–µ–∫., —Å–±")
2. –£—á–∏—Ç—ã–≤–∞–π –ø–æ–≥–æ–¥—É - –¥–Ω–∏ –±–µ–∑ –¥–æ–∂–¥—è –ª—É—á—à–µ –¥–ª—è —Å—É—à–∫–∏
3. –ü–ª–∞–Ω–∏—Ä—É–π —Å—Ç–∏—Ä–∫—É —Ç–∞–∫, —á—Ç–æ–±—ã –æ–¥–µ–∂–¥–∞ —Ç–æ—á–Ω–æ –≤—ã—Å–æ—Ö–ª–∞ –∫ —Ü–µ–ª–µ–≤–æ–π –¥–∞—Ç–µ
4. –í –æ—Ç–≤–µ—Ç–µ —É–∫–∞–∑—ã–≤–∞–π –¢–û–ß–ù–£–Æ –î–ê–¢–£ –∏–∑ –ø—Ä–æ–≥–Ω–æ–∑–∞, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ "—Å—É–±–±–æ—Ç–∞"

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ:
{
  "washDays": [{"day": "—Ç–æ—á–Ω–∞—è –¥–∞—Ç–∞ –∏–∑ –ø—Ä–æ–≥–Ω–æ–∑–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 4 —è–Ω–≤., –ø—Ç)", "reason": "–ø–æ—á–µ–º—É —ç—Ç–æ—Ç –¥–µ–Ω—å"}],
  "capsules": —á–∏—Å–ª–æ_–∫–∞–ø—Å—É–ª,
  "recommendations": ["—Å–æ–≤–µ—Ç1", "—Å–æ–≤–µ—Ç2", "—Å–æ–≤–µ—Ç3"],
  "dryingTime": "–æ—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—à–∫–∏"
}`;

                const response = await fetch('https://api.llm7.io/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'gpt-5-mini',
                        messages: [{ role: 'user', content: prompt }],
                        temperature: 0.7
                    })
                });

                const data = await response.json();
                let content = data.choices[0].message.content;
                content = content.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();

                const plan = JSON.parse(content);
                state.currentLaundryPlan = { plan, targetDate, laundryType };

                container.innerHTML = `
                    <div style="background: var(--card-bg); border-radius: 12px; padding: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s ease;">
                        <h3 style="font-size: 20px; font-weight: bold; color: #8b5cf6; margin-bottom: 16px;">ü§ñ –í–∞—à –ø–ª–∞–Ω —Å—Ç–∏—Ä–∫–∏</h3>

                        <div style="background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%); padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                            <div style="font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">–ö–æ–≥–¥–∞ —Å—Ç–∏—Ä–∞—Ç—å:</div>
                            ${plan.washDays.map(d => `
                                <div style="margin-bottom: 8px; padding: 8px; background: var(--card-bg); border-radius: 6px; color: var(--text-primary); transition: all 0.3s ease;">
                                    <strong>${d.day}</strong> - ${d.reason}
                                </div>
                            `).join('')}
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 16px;">
                            <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 12px; border-radius: 8px;">
                                <div style="font-weight: 600; color: var(--text-primary);">–ö–∞–ø—Å—É–ª—ã</div>
                                <div style="font-size: 24px; font-weight: bold; color: #1e40af;">${plan.capsules}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 12px; border-radius: 8px;">
                                <div style="font-weight: 600; color: var(--text-primary);">–í—Ä–µ–º—è —Å—É—à–∫–∏</div>
                                <div style="font-size: 16px; font-weight: bold; color: #065f46;">${plan.dryingTime}</div>
                            </div>
                        </div>

                        <div style="background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%); padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                            <div style="font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</div>
                            <ul style="margin-left: 20px; color: var(--text-primary);">
                                ${plan.recommendations.map(r => `<li style="margin-bottom: 4px;">${r}</li>`).join('')}
                            </ul>
                        </div>

                        <div style="display: flex; gap: 12px; justify-content: center;">
                            <button onclick="acceptLaundryPlan()" class="btn-primary" style="flex: 1; max-width: 250px;">
                                ‚úì –ü—Ä–∏–Ω—è—Ç—å –ø–ª–∞–Ω
                            </button>
                            <button onclick="declineLaundryPlan()" class="btn-secondary" style="flex: 1; max-width: 250px;">
                                ‚úó –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                            </button>
                        </div>
                    </div>
                `;

            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞–Ω–∞:', e);
                container.innerHTML = `
                    <div style="background: #fee2e2; color: #dc2626; padding: 16px; border-radius: 8px;">
                        –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.
                    </div>
                `;
            }
        }

        function acceptLaundryPlan() {
            if (!state.currentLaundryPlan) return;

            const { plan, targetDate, laundryType } = state.currentLaundryPlan;

            // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—ã –∏–∑ –ø—Ä–æ–≥–Ω–æ–∑–∞ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            plan.washDays.forEach((washDay, index) => {
                // –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É –∏–∑ —Ç–µ–∫—Å—Ç–∞ —Ç–∏–ø–∞ "4 —è–Ω–≤., –ø—Ç"
                // –ò—â–µ–º –±–ª–∏–∂–∞–π—à—É—é –¥–∞—Ç—É —Å —Ç–∞–∫–∏–º –∂–µ –¥–Ω–µ–º –Ω–µ–¥–µ–ª–∏
                const dayMatch = washDay.day.match(/(\d+)\s+(\S+)/);

                if (dayMatch) {
                    const day = parseInt(dayMatch[1]);
                    const monthMap = {
                        '—è–Ω–≤': 0, '—Ñ–µ–≤': 1, '–º–∞—Ä': 2, '–∞–ø—Ä': 3, '–º–∞–π': 4, '–∏—é–Ω': 5,
                        '–∏—é–ª': 6, '–∞–≤–≥': 7, '—Å–µ–Ω': 8, '–æ–∫—Ç': 9, '–Ω–æ—è': 10, '–¥–µ–∫': 11
                    };

                    const monthAbbr = dayMatch[2].replace('.', '').toLowerCase().substring(0, 3);
                    const month = monthMap[monthAbbr] ?? today.getMonth();

                    const washDate = new Date(today.getFullYear(), month, day);
                    // –ï—Å–ª–∏ –¥–∞—Ç–∞ –≤ –ø—Ä–æ—à–ª–æ–º, –±–µ—Ä–µ–º —Å–ª–µ–¥—É—é—â–∏–π –≥–æ–¥
                    if (washDate < today) {
                        washDate.setFullYear(today.getFullYear() + 1);
                    }

                    const dateStr = washDate.toISOString().split('T')[0];

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ –∑–∞–ø–∏—Å–∏ –Ω–∞ —ç—Ç—É –¥–∞—Ç—É
                    const existingIndex = state.laundrySchedule.findIndex(item => item.date === dateStr);
                    if (existingIndex === -1) {
                        state.laundrySchedule.push({
                            date: dateStr,
                            type: laundryType === 'everyday' ? '–ü–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–∞—è' :
                                  laundryType === 'workout' ? '–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è' :
                                  laundryType === 'formal' ? '–î–µ–ª–æ–≤–∞—è' : '–°—Ç–∏—Ä–∫–∞',
                            notes: washDay.reason,
                            completed: false
                        });
                    }
                } else {
                    // –ï—Å–ª–∏ –Ω–µ —Å–º–æ–≥–ª–∏ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å - –¥–æ–±–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ N –¥–Ω–µ–π –æ—Ç —Å–µ–≥–æ–¥–Ω—è
                    const washDate = new Date(today);
                    washDate.setDate(today.getDate() + index + 1);
                    const dateStr = washDate.toISOString().split('T')[0];

                    state.laundrySchedule.push({
                        date: dateStr,
                        type: laundryType === 'everyday' ? '–ü–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–∞—è' :
                              laundryType === 'workout' ? '–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è' :
                              laundryType === 'formal' ? '–î–µ–ª–æ–≤–∞—è' : '–°—Ç–∏—Ä–∫–∞',
                        notes: washDay.reason,
                        completed: false
                    });
                }

                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
                state.laundryHistory.push({
                    id: Date.now() + Math.random(),
                    date: new Date().toISOString(),
                    type: laundryType,
                    scheduledFor: washDay.day,
                    targetDate: targetDate,
                    status: 'planned',
                    notes: washDay.reason
                });
            });

            // –£–º–µ–Ω—å—à–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–ø—Å—É–ª
            const capsulesNeeded = parseInt(plan.capsules) || 0;
            console.log('–ö–∞–ø—Å—É–ª—ã –¥–æ:', state.capsules, '–ù—É–∂–Ω–æ:', capsulesNeeded);

            state.capsules = Math.max(0, parseInt(state.capsules) - capsulesNeeded);
            console.log('–ö–∞–ø—Å—É–ª—ã –ø–æ—Å–ª–µ:', state.capsules);

            updateCapsulesDisplay();

            saveToStorage();
            renderLaundryHistory();
            renderLaundryCalendar();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            const container = document.getElementById('laundry-plan-container');
            container.innerHTML = `
                <div style="background: #d1fae5; color: #065f46; padding: 20px; border-radius: 12px; text-align: center; animation: slideIn 0.3s ease-out;">
                    <div style="font-size: 24px; margin-bottom: 8px;">‚úì</div>
                    <div style="font-weight: 600; font-size: 18px;">–ü–ª–∞–Ω –ø—Ä–∏–Ω—è—Ç!</div>
                    <div style="font-size: 14px; margin-top: 8px;">–°—Ç–∏—Ä–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å (${plan.washDays.length} ${plan.washDays.length === 1 ? '–¥–µ–Ω—å' : '–¥–Ω—è/–¥–Ω–µ–π'})</div>
                </div>
            `;

            // –£–±–∏—Ä–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);

            state.currentLaundryPlan = null;
        }

        function declineLaundryPlan() {
            document.getElementById('laundry-plan-container').innerHTML = `
                <div style="background: var(--tab-inactive-bg); color: var(--text-secondary); padding: 20px; border-radius: 12px; text-align: center;">
                    <div style="font-size: 18px;">–ü–ª–∞–Ω –æ—Ç–∫–ª–æ–Ω–µ–Ω</div>
                    <div style="font-size: 14px; margin-top: 8px;">–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø–ª–∞–Ω —Å –¥—Ä—É–≥–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏</div>
                </div>
            `;
            state.currentLaundryPlan = null;
        }

        // UI
        // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
        async function generateShoppingRecommendations() {
            const category = document.getElementById('shop-category').value;
            const container = document.getElementById('shop-container');

            container.innerHTML = '<div style="text-align: center; padding: 48px;"><div class="spinner" style="border-color: #8b5cf6; border-top-color: transparent;"></div></div>';

            try {
                const wardrobeContext = state.wardrobe.map(item =>
                    `${item.name} (${item.color}, ${item.type})`
                ).join(', ');

                const styleContext = state.preferredStyle ?
                    `–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π —Å—Ç–∏–ª—å: ${state.preferredStyle === 'oversized' ? '–º—è–≥–∫–∏–π oversized' : state.preferredStyle === 'business' ? '—Å—Ç—Ä–æ–≥–∏–π business casual' : state.preferredStyle === 'sport' ? '—Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π' : '—Å–º–µ—à–∞–Ω–Ω—ã–π'}` : '';

                const ageContext = state.ageGroup ? `–í–æ–∑—Ä–∞—Å—Ç: ${state.ageGroup}` : '';

                const categoryText = category === 'all' ? '–ª—é–±—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' :
                    category === 'top' ? '–≤–µ—Ä—Ö (—Ñ—É—Ç–±–æ–ª–∫–∏, —Å–≤–∏—Ç–µ—Ä–∞, —Ä—É–±–∞—à–∫–∏)' :
                    category === 'bottom' ? '–Ω–∏–∑ (–±—Ä—é–∫–∏, —é–±–∫–∏, —à–æ—Ä—Ç—ã)' :
                    category === 'outerwear' ? '–≤–µ—Ä—Ö–Ω—è—è –æ–¥–µ–∂–¥–∞ (–∫—É—Ä—Ç–∫–∏, –ø–∞–ª—å—Ç–æ)' :
                    category === 'shoes' ? '–æ–±—É–≤—å' : '–∞–∫—Å–µ—Å—Å—É–∞—Ä—ã';

                const prompt = `–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —à–æ–ø–ø–∏–Ω–≥-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –ù–∞ –æ—Å–Ω–æ–≤–µ –≥–∞—Ä–¥–µ—Ä–æ–±–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–¥–±–µ—Ä–∏ 6 —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤ (Wildberries, Ozon, Lamoda).

–¢–ï–ö–£–©–ò–ô –ì–ê–†–î–ï–†–û–ë:
${wardrobeContext || '–ë–∞–∑–æ–≤—ã–π –≥–∞—Ä–¥–µ—Ä–æ–±'}

–ü–ï–†–°–û–ù–ê–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø:
${ageContext}
${styleContext}

–ó–ê–î–ê–ß–ê:
- –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${categoryText}
- –ü–æ–¥–±–µ—Ä–∏ –≤–µ—â–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ø–æ–ª–Ω—è—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –≥–∞—Ä–¥–µ—Ä–æ–±
- –£—á–∏—Ç—ã–≤–∞–π —Å—Ç–∏–ª—å –∏ –≤–æ–∑—Ä–∞—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–æ–¥–±–µ—Ä–∏ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç —Ä–∞–∑–Ω—ã—Ö –±—Ä–µ–Ω–¥–æ–≤ –∏ —Å—Ç–∏–ª–µ–π

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ - –º–∞—Å—Å–∏–≤ –∏–∑ 6 —Ç–æ–≤–∞—Ä–æ–≤:
[
  {
    "name": "–Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞",
    "category": "–∫–∞—Ç–µ–≥–æ—Ä–∏—è",
    "marketplace": "Wildberries/Ozon/Lamoda",
    "searchQuery": "—Ç–æ—á–Ω—ã–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞",
    "description": "–∫–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ)",
    "whyGood": "–ø–æ—á–µ–º—É –ø–æ–¥—Ö–æ–¥–∏—Ç –∫ –≥–∞—Ä–¥–µ—Ä–æ–±—É (1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ)"
  }
]`;

                const response = await fetch('https://api.llm7.io/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'gpt-5-mini',
                        messages: [{ role: 'user', content: prompt }],
                        temperature: 0.8
                    })
                });

                const data = await response.json();
                let content = data.choices[0].message.content;
                content = content.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();

                const products = JSON.parse(content);
                renderShoppingRecommendations(products);

            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–±–æ—Ä–∞ —Ç–æ–≤–∞—Ä–æ–≤:', e);
                container.innerHTML = `
                    <div style="background: #fee2e2; color: #dc2626; padding: 16px; border-radius: 8px;">
                        –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–±–æ—Ä–µ —Ç–æ–≤–∞—Ä–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.
                    </div>
                `;
            }
        }

        function renderShoppingRecommendations(products) {
            const container = document.getElementById('shop-container');

            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    ${products.map(product => {
                        const marketplaceUrl =
                            product.marketplace === 'Wildberries' ? `https://www.wildberries.ru/catalog/0/search.aspx?search=${encodeURIComponent(product.searchQuery)}` :
                            product.marketplace === 'Ozon' ? `https://www.ozon.ru/search/?text=${encodeURIComponent(product.searchQuery)}` :
                            `https://www.lamoda.ru/catalogsearch/result/?q=${encodeURIComponent(product.searchQuery)}`;

                        const marketplaceColor =
                            product.marketplace === 'Wildberries' ? '#CB11AB' :
                            product.marketplace === 'Ozon' ? '#005BFF' :
                            '#7000FF';

                        return `
                            <div style="background: var(--card-bg); border-radius: 16px; padding: 24px; transition: all 0.3s ease; border: 1px solid var(--border-color); animation: slideIn 0.3s ease-out;">
                                <h4 style="font-weight: 600; font-size: 17px; color: var(--text-primary); margin: 0 0 16px 0;">
                                    ${product.name}
                                </h4>

                                <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 16px; line-height: 1.5;">
                                    ${product.description}
                                </p>

                                <div style="background: var(--tab-inactive-bg); padding: 14px; border-radius: 10px; margin-bottom: 18px;">
                                    <p style="font-size: 13px; color: var(--text-secondary); margin: 0; line-height: 1.4;">
                                        ${product.whyGood}
                                    </p>
                                </div>

                                <a href="${marketplaceUrl}" target="_blank" rel="noopener noreferrer"
                                   style="display: flex; align-items: center; justify-content: center; gap: 8px; background: ${marketplaceColor}; color: white; padding: 14px; border-radius: 10px; text-decoration: none; font-weight: 600; font-size: 15px; transition: all 0.2s;">
                                    <span>–ù–∞–π—Ç–∏ –Ω–∞ ${product.marketplace}</span>
                                    <span style="font-size: 18px;">‚Üí</span>
                                </a>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));

            if (tab === 'suggest') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('tab-suggest').classList.remove('hidden');
            } else if (tab === 'wardrobe') {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('tab-wardrobe').classList.remove('hidden');
            } else if (tab === 'laundry') {
                document.querySelectorAll('.tab')[2].classList.add('active');
                document.getElementById('tab-laundry').classList.remove('hidden');
                renderLaundryCalendar();
                renderLaundryHistory();
            } else if (tab === 'shop') {
                document.querySelectorAll('.tab')[3].classList.add('active');
                document.getElementById('tab-shop').classList.remove('hidden');
            } else if (tab === 'results') {
                document.getElementById('tab-results').classList.remove('hidden');
            }
        }

        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        function renderStats() {
            const container = document.getElementById('stats-container');

            if (state.outfitHistory.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 48px; color: var(--text-secondary);">
                        <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;">üìà</div>
                        <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏. –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –æ–±—Ä–∞–∑—ã!</p>
                    </div>
                `;
                return;
            }

            // –ü–æ–¥—Å—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–µ—â–µ–π
            const itemUsage = {};
            state.outfitHistory.forEach(entry => {
                entry.outfit.items.forEach(item => {
                    itemUsage[item] = (itemUsage[item] || 0) + 1;
                });
            });

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —á–∞—Å—Ç–æ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
            const sorted = Object.entries(itemUsage).sort((a, b) => b[1] - a[1]);
            const total = state.outfitHistory.length;

            container.innerHTML = `
                <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 32px;">
                    <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 20px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 32px; font-weight: bold; color: #1e40af;">${total}</div>
                        <div style="font-size: 14px; color: #1e40af; margin-top: 4px;">–í—Å–µ–≥–æ –æ–±—Ä–∞–∑–æ–≤</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 20px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 32px; font-weight: bold; color: #065f46;">${sorted.length}</div>
                        <div style="font-size: 14px; color: #065f46; margin-top: 4px;">–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –≤–µ—â–µ–π</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%); padding: 20px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 32px; font-weight: bold; color: #9f1239;">${sorted[0] ? sorted[0][1] : 0}</div>
                        <div style="font-size: 14px; color: #9f1239; margin-top: 4px;">–ú–∞–∫—Å. –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π</div>
                    </div>
                </div>

                <!-- –¢–æ–ø –≤–µ—â–µ–π -->
                <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 16px; color: var(--text-primary);">–¢–æ–ø –≤–µ—â–µ–π</h3>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    ${sorted.slice(0, 10).map(([ item, count], idx) => {
                        const percentage = Math.round((count / total) * 100);
                        const medal = idx === 0 ? 'ü•á' : idx === 1 ? 'ü•à' : idx === 2 ? 'ü•â' : '';

                        return `
                            <div style="background: var(--card-bg); border-radius: 10px; padding: 16px; transition: all 0.3s ease; border: 1px solid var(--border-color);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                                        <span style="font-size: 24px;">${medal}</span>
                                        <span style="font-weight: 600; color: var(--text-primary);">${item}</span>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-weight: 700; font-size: 18px; color: var(--text-primary);">${count}</div>
                                        <div style="font-size: 12px; color: var(--text-secondary);">${percentage}%</div>
                                    </div>
                                </div>
                                <div style="background: var(--tab-inactive-bg); border-radius: 4px; height: 8px; overflow: hidden;">
                                    <div style="background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%); height: 100%; width: ${percentage}%; transition: width 0.3s ease;"></div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>

                <!-- –†–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤–µ—â–∏ -->
                ${sorted.filter(([_, count]) => count === 1).length > 0 ? `
                    <h3 style="font-size: 20px; font-weight: bold; margin: 32px 0 16px; color: var(--text-primary);">–†–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤–µ—â–∏</h3>
                    <div style="background: var(--tab-inactive-bg); padding: 16px; border-radius: 10px;">
                        <p style="color: var(--text-secondary); margin-bottom: 12px; font-size: 14px;">–≠—Ç–∏ –≤–µ—â–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã —Ç–æ–ª—å–∫–æ 1 —Ä–∞–∑:</p>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${sorted.filter(([_, count]) => count === 1).map(([item]) => `
                                <span style="background: var(--card-bg); padding: 8px 12px; border-radius: 6px; font-size: 14px; color: var(--text-primary);">
                                    ${item}
                                </span>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            `;
        }

        function showLocationModal() {
            document.getElementById('location-modal').classList.add('show');
        }

        function hideLocationModal() {
            document.getElementById('location-modal').classList.remove('show');
        }

        // –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
        function showRemindersModal() {
            document.getElementById('reminders-modal').classList.add('show');
            renderRemindersList();
            checkReminders();
        }

        function hideRemindersModal() {
            document.getElementById('reminders-modal').classList.remove('show');
        }

        function addReminder() {
            const type = document.getElementById('reminder-type').value;
            const text = document.getElementById('reminder-text').value;
            const datetime = document.getElementById('reminder-datetime').value;

            if (!text || !datetime) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }

            const reminder = {
                id: Date.now(),
                type: type,
                text: text,
                datetime: new Date(datetime).toISOString(),
                completed: false,
                createdAt: new Date().toISOString()
            };

            state.reminders.push(reminder);
            saveToStorage();
            renderRemindersList();

            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('reminder-text').value = '';
            document.getElementById('reminder-datetime').value = '';

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
            scheduleReminderCheck();
        }

        function renderRemindersList() {
            const container = document.getElementById('reminders-list');
            const activeReminders = state.reminders.filter(r => !r.completed);

            if (activeReminders.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 24px; color: var(--text-secondary);">
                        –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
                    </div>
                `;
                return;
            }

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ
            const sorted = activeReminders.sort((a, b) => new Date(a.datetime) - new Date(b.datetime));

            container.innerHTML = sorted.map(reminder => {
                const date = new Date(reminder.datetime);
                const dateStr = date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });
                const timeStr = date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
                const isPast = date < new Date();

                const typeEmoji = {
                    'laundry': 'üß∫',
                    'event': 'üìÖ',
                    'shopping': 'üõçÔ∏è',
                    'other': 'üìå'
                }[reminder.type];

                return `
                    <div style="background: var(--tab-inactive-bg); padding: 12px; border-radius: 8px; margin-bottom: 8px; ${isPast ? 'opacity: 0.6;' : ''}">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                    <span style="font-size: 18px;">${typeEmoji}</span>
                                    <span style="font-weight: 600; color: var(--text-primary);">${reminder.text}</span>
                                </div>
                                <div style="font-size: 13px; color: var(--text-secondary);">
                                    ${dateStr} –≤ ${timeStr} ${isPast ? '(–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ)' : ''}
                                </div>
                            </div>
                            <button onclick="deleteReminder(${reminder.id})" style="background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 18px;">
                                ‚úñÔ∏è
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            // –û–±–Ω–æ–≤–ª—è–µ–º badge
            updateRemindersBadge();
        }

        function deleteReminder(id) {
            state.reminders = state.reminders.filter(r => r.id !== id);
            saveToStorage();
            renderRemindersList();
        }

        function checkReminders() {
            const now = new Date();
            const activeReminders = state.reminders.filter(r => !r.completed);

            activeReminders.forEach(reminder => {
                const reminderDate = new Date(reminder.datetime);
                const diff = reminderDate - now;

                // –ï—Å–ª–∏ –æ—Å—Ç–∞–ª–æ—Å—å –º–µ–Ω—å—à–µ 1 –º–∏–Ω—É—Ç—ã - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                if (diff > 0 && diff < 60000) {
                    showReminderNotification(reminder);
                    reminder.completed = true;
                    saveToStorage();
                }
            });
        }

        function showReminderNotification(reminder) {
            const typeEmoji = {
                'laundry': 'üß∫',
                'event': 'üìÖ',
                'shopping': 'üõçÔ∏è',
                'other': 'üìå'
            }[reminder.type];

            alert(`${typeEmoji} –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ!\n\n${reminder.text}`);

            // –ï—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Notification API
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('–£–º–Ω—ã–π –≥–∞—Ä–¥–µ—Ä–æ–±', {
                    body: reminder.text,
                    icon: '‚ú®'
                });
            }
        }

        function scheduleReminderCheck() {
            setInterval(checkReminders, 30000); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        }

        function updateRemindersBadge() {
            const activeCount = state.reminders.filter(r => !r.completed && new Date(r.datetime) > new Date()).length;
            const btn = document.getElementById('reminders-btn');

            if (activeCount > 0) {
                btn.innerHTML = `üîî<span style="position: absolute; top: -4px; right: -4px; background: #ef4444; color: white; font-size: 10px; font-weight: bold; padding: 2px 5px; border-radius: 10px;">${activeCount}</span>`;
                btn.style.position = 'relative';
            } else {
                btn.innerHTML = 'üîî';
            }
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–ø—Å—É–ª–∞–º–∏
        function updateCapsulesDisplay() {
            const count = parseInt(state.capsules) || 0;
            document.getElementById('capsules-count').textContent = count;

            // –û—Ü–µ–Ω–∫–∞ –Ω–∞ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π —Ö–≤–∞—Ç–∏—Ç (–ø—Ä–∏–º–µ—Ä–Ω–æ 3 —Å—Ç–∏—Ä–∫–∏ –≤ –Ω–µ–¥–µ–ª—é = 1 –∫–∞–ø—Å—É–ª–∞ –∫–∞–∂–¥—ã–µ ~2 –¥–Ω—è)
            const estimatedDays = Math.floor(count * 2.3);
            document.getElementById('capsules-days').textContent = count > 0 ? `~${estimatedDays} –¥–Ω–µ–π` : '0 –¥–Ω–µ–π';

            // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
            const alert = document.getElementById('capsules-alert');

            if (count === 0) {
                alert.style.display = 'block';
                alert.innerHTML = '–ö–∞–ø—Å—É–ª—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å! –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø–∞—Å.';
            } else if (count < 5) {
                alert.style.display = 'block';
                alert.innerHTML = '–ö–∞–ø—Å—É–ª—ã –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è! –û—Å—Ç–∞–ª–æ—Å—å –º–µ–Ω–µ–µ 5 —à—Ç—É–∫.';
            } else {
                alert.style.display = 'none';
            }
        }

        function addCapsules() {
            const amount = prompt('–°–∫–æ–ª—å–∫–æ –∫–∞–ø—Å—É–ª –¥–æ–±–∞–≤–∏—Ç—å?', '10');
            if (amount && !isNaN(amount)) {
                const currentCapsules = parseInt(state.capsules) || 0;
                const addAmount = parseInt(amount) || 0;
                state.capsules = currentCapsules + addAmount;

                console.log('–î–æ–±–∞–≤–ª—è–µ–º –∫–∞–ø—Å—É–ª—ã:', currentCapsules, '+', addAmount, '=', state.capsules);

                updateCapsulesDisplay();
                saveToStorage();
            }
        }


        // –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∏—Ä–æ–∫
        function addToLaundryHistory(date, type) {
            state.laundryHistory.push({
                id: Date.now(),
                date: date,
                type: type,
                timestamp: new Date().toISOString()
            });
            saveToStorage();
        }

        function renderLaundryHistory() {
            const container = document.getElementById('laundry-history-container');

            if (state.laundryHistory.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">–ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∏—Ä–æ–∫ –ø—É—Å—Ç–∞</p>';
                return;
            }

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            const sorted = [...state.laundryHistory].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            container.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    ${sorted.map(item => {
                        // –ú–∞–ø–ø–∏–Ω–≥ —Ç–∏–ø–æ–≤ —Å—Ç–∏—Ä–∫–∏
                        const typeMap = {
                            'everyday': '–ü–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–∞—è',
                            'workout': '–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è',
                            'formal': '–î–µ–ª–æ–≤–∞—è',
                            'all': '–í—Å—è –æ–¥–µ–∂–¥–∞'
                        };
                        const displayType = typeMap[item.type] || item.type;

                        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É (–µ—Å–ª–∏ –µ—Å—Ç—å scheduledFor, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ)
                        const scheduledText = item.scheduledFor || '–î–∞—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞';

                        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
                        const timestamp = new Date(item.timestamp || item.date);
                        const isValidDate = !isNaN(timestamp.getTime());
                        const formattedTime = isValidDate
                            ? timestamp.toLocaleString('ru-RU', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' })
                            : '–ù–µ–¥–∞–≤–Ω–æ';

                        return `
                            <div style="background: var(--tab-inactive-bg); padding: 16px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s ease; animation: slideIn 0.3s ease-out;">
                                <div style="flex: 1;">
                                    <div style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: 6px;">
                                        üß∫ ${displayType}
                                    </div>
                                    <div style="font-size: 13px; color: var(--text-secondary);">
                                        –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ: ${scheduledText}
                                    </div>
                                    <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                                        –î–æ–±–∞–≤–ª–µ–Ω–æ: ${formattedTime}
                                    </div>
                                </div>
                                <button onclick="deleteLaundryHistoryItem(${item.id})" style="background: #ef4444; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.2s;">
                                    üóëÔ∏è
                                </button>
                            </div>
                        `;
                    }).join('')}
                </div>

                <div style="margin-top: 20px; padding: 16px; background: var(--tab-inactive-bg); border-radius: 10px; text-align: center;">
                    <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 4px;">–í—Å–µ–≥–æ —Å—Ç–∏—Ä–æ–∫ –≤ –∏—Å—Ç–æ—Ä–∏–∏</div>
                    <div style="font-size: 32px; font-weight: 700; color: #8b5cf6;">${state.laundryHistory.length}</div>
                </div>
            `;
        }

        function deleteLaundryHistoryItem(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏?')) {
                state.laundryHistory = state.laundryHistory.filter(item => item.id !== id);
                saveToStorage();
                renderLaundryHistory();
            }
        }

        function updateCounts() {
            document.getElementById('wardrobe-count').textContent = state.wardrobe.length;
            document.getElementById('saved-count').textContent = state.savedOutfits.length;
        }

        // –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç
        function exportWardrobe() {
            const data = JSON.stringify({ wardrobe: state.wardrobe, savedOutfits: state.savedOutfits }, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '–º–æ–π-–≥–∞—Ä–¥–µ—Ä–æ–±.json';
            a.click();
        }

        function importWardrobe(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.wardrobe) state.wardrobe = data.wardrobe;
                        if (data.savedOutfits) state.savedOutfits = data.savedOutfits;
                        saveToStorage();
                        renderWardrobe();
                        renderSavedOutfits();
                        updateCounts();
                        alert('–ì–∞—Ä–¥–µ—Ä–æ–± –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!');
                    } catch (err) {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Ñ–∞–π–ª–∞');
                    }
                };
                reader.readAsText(file);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        init();

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker –¥–ª—è PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
                    });
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('üí° PWA –≥–æ—Ç–æ–≤–æ –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ!');

            // –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
            // –ò–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–º–ø—Ç —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è
            setTimeout(() => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å—Ç–∞–Ω–æ–≤–∏–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ');
                        } else {
                            console.log('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–∏–ª —É—Å—Ç–∞–Ω–æ–≤–∫—É');
                        }
                        deferredPrompt = null;
                    });
                }
            }, 3000); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        });

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏
        window.addEventListener('appinstalled', () => {
            console.log('üéâ PWA —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!');
            deferredPrompt = null;
        });
    </script>
</body>
</html>
